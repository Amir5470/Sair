{"version":3,"file":"index.js","mappings":"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;IACrC,IAAI,CAACI,GAAG,EAAE;MACR,MAAM,IAAIF,KAAK,CAAC,iCAAiC,CAAC;IACpD;IAEA,MAAMwe,aAAa,GAAG,IAAI,CAACpQ,2BAA2B,CAACtO,GAAG,CAAC;IAE3D,IAAI,CAACoe,iBAAiB,CAAC5f,GAAG,CAAC4B,GAAG,EAAEJ,GAAG,CAAC;IAEpC,IAAIA,GAAG,CAAC5D,EAAE,MAAKsiB,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEtiB,EAAE,GAAE;MAChC,IAAI,CAACmE,IAAI,CAAC,oBAAoB,EAAEP,GAAG,EAAEI,GAAG,CAAC;MAEzC,IAAI,OAAO,IAAI,CAACoP,IAAI,CAACiI,SAAS,KAAK,UAAU,EAAE;QAC7C,IAAI,CAACjI,IAAI,CAACiI,SAAS,CAACzX,GAAG,EAAEI,GAAG,CAAC;MAC/B;IACF;EACF;EAEAkB,cAAc,CAAChH,WAAmB,EAAEgO,QAAyB,EAAuB;IAClF;IACA,OAAO,EAAE;EACX;AACF;;;;;;;;;;ACpMA;;AAEA;AACA;AACA;;AAEA,kBAAkB;AAClB,YAAY;AACZ,YAAY;AACZ,iBAAiB;AACjB,eAAe;AACf,eAAe;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,4CAA4C;;AAEvD;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA,iBAAiB,mBAAO,CAAC,wDAAU;;AAEnC,OAAO,YAAY;;AAEnB;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;;;;;;;;;;;AC3QA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,mBAAO,CAAC,0CAAI;AACpC;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY,eAAe;AAC3B;AACA;AACA;AACA;;AAEA,kBAAkB,sBAAsB;AACxC;AACA,cAAc;AACd;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,uCAAuC;;AAEvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,cAAc,SAAS;AACvB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,8CAA8C,SAAS;AACvD;AACA;AACA;AACA;;AAEA,8CAA8C,SAAS;AACvD;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;;;;;;;;;;ACpQA;AACA;AACA;AACA;;AAEA;AACA,CAAC,mGAAwC;AACzC,EAAE;AACF,CAAC,6FAAqC;AACtC;;;;;;;;;;;ACTA;AACA;AACA;;AAEA,YAAY,mBAAO,CAAC,gBAAK;AACzB,aAAa,mBAAO,CAAC,kBAAM;;AAE3B;AACA;AACA;;AAEA,YAAY;AACZ,WAAW;AACX,kBAAkB;AAClB,YAAY;AACZ,YAAY;AACZ,iBAAiB;AACjB,eAAe;AACf,SAAS;AACT;AACA;;AAEA;AACA;AACA;;AAEA,cAAc;;AAEd;AACA;AACA;AACA,uBAAuB,mBAAO,CAAC,kEAAgB;;AAE/C;AACA,EAAE,cAAc;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF,6DAA6D;AAC7D;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB;AACnB;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA,CAAC,IAAI;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,4BAA4B;;AAEpC;AACA;AACA,iDAAiD,EAAE;AACnD,sBAAsB,WAAW,IAAI,MAAM;;AAE3C;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,QAAQ;AACpB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iBAAiB,iBAAiB;AAClC;AACA;AACA;;AAEA,iBAAiB,mBAAO,CAAC,wDAAU;;AAEnC,OAAO,YAAY;;AAEnB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACtQa;;AAEb;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACPA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,eAAe;AAC1B,WAAW,QAAQ;AACnB,YAAY,OAAO;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,QAAQ;AACnB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACjKa;AACb,WAAW,mBAAO,CAAC,cAAI;AACvB,YAAY,mBAAO,CAAC,gBAAK;AACzB,gBAAgB,mBAAO,CAAC,sDAAU;;AAElC,OAAO,KAAK;;AAEZ;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,oCAAoC,gCAAgC,IAAI;AACxE;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,iCAAiC,GAAG;AACpC;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,6CAA6C;AAC7C;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA,0BAA0B,qBAAqB;AAC/C,0BAA0B,qBAAqB;AAC/C;;;;;;;;;;;;ACvJA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D","sources":["webpack://electron-chrome-extensions/./src/browser/api/browser-action.ts","webpack://electron-chrome-extensions/./src/browser/api/commands.ts","webpack://electron-chrome-extensions/./src/browser/api/common.ts","webpack://electron-chrome-extensions/./src/browser/api/context-menus.ts","webpack://electron-chrome-extensions/./src/browser/api/cookies.ts","webpack://electron-chrome-extensions/./src/browser/api/notifications.ts","webpack://electron-chrome-extensions/./src/browser/api/runtime.ts","webpack://electron-chrome-extensions/./src/browser/api/tabs.ts","webpack://electron-chrome-extensions/./src/browser/api/web-navigation.ts","webpack://electron-chrome-extensions/./src/browser/api/windows.ts","webpack://electron-chrome-extensions/./src/browser/index.ts","webpack://electron-chrome-extensions/./src/browser/popup.ts","webpack://electron-chrome-extensions/./src/browser/router.ts","webpack://electron-chrome-extensions/./src/browser/store.ts","webpack://electron-chrome-extensions/../../node_modules/debug/src/browser.js","webpack://electron-chrome-extensions/../../node_modules/debug/src/common.js","webpack://electron-chrome-extensions/../../node_modules/debug/src/index.js","webpack://electron-chrome-extensions/../../node_modules/debug/src/node.js","webpack://electron-chrome-extensions/../../node_modules/has-flag/index.js","webpack://electron-chrome-extensions/../../node_modules/ms/index.js","webpack://electron-chrome-extensions/../../node_modules/supports-color/index.js","webpack://electron-chrome-extensions/external node-commonjs \"electron\"","webpack://electron-chrome-extensions/external node-commonjs \"events\"","webpack://electron-chrome-extensions/external node-commonjs \"fs\"","webpack://electron-chrome-extensions/external node-commonjs \"os\"","webpack://electron-chrome-extensions/external node-commonjs \"path\"","webpack://electron-chrome-extensions/external node-commonjs \"tty\"","webpack://electron-chrome-extensions/external node-commonjs \"util\"","webpack://electron-chrome-extensions/webpack/bootstrap","webpack://electron-chrome-extensions/webpack/runtime/compat get default export","webpack://electron-chrome-extensions/webpack/runtime/define property getters","webpack://electron-chrome-extensions/webpack/runtime/hasOwnProperty shorthand","webpack://electron-chrome-extensions/webpack/runtime/make namespace object","webpack://electron-chrome-extensions/./src/index.ts"],"sourcesContent":["import { Menu, MenuItem, protocol, nativeImage, app } from 'electron'\nimport { ExtensionContext } from '../context'\nimport { PopupView } from '../popup'\nimport { ExtensionEvent } from '../router'\nimport {\n  getExtensionUrl,\n  getExtensionManifest,\n  getIconPath,\n  resolveExtensionPath,\n  matchSize,\n  ResizeType,\n} from './common'\n\nconst debug = require('debug')('electron-chrome-extensions:browserAction')\n\nif (!app.isReady()) {\n  protocol.registerSchemesAsPrivileged([{ scheme: 'crx', privileges: { bypassCSP: true } }])\n}\n\ninterface ExtensionAction {\n  color?: string\n  text?: string\n  title?: string\n  icon?: chrome.browserAction.TabIconDetails\n  popup?: string\n  /** Last modified date for icon. */\n  iconModified?: number\n}\n\ntype ExtensionActionKey = keyof ExtensionAction\n\ninterface ActivateDetails {\n  eventType: string\n  extensionId: string\n  tabId: number\n  anchorRect: { x: number; y: number; width: number; height: number }\n}\n\nconst getBrowserActionDefaults = (extension: Electron.Extension): ExtensionAction | undefined => {\n  const manifest = getExtensionManifest(extension)\n  const { action, browser_action } = manifest\n  let manifestAction: any = {}\n\n  if (typeof action === 'object') {\n    manifestAction = action;\n  } else if (typeof browser_action === 'object') {\n    manifestAction = browser_action;\n  } else {\n    return;\n  }\n\n  const extensionAction: ExtensionAction = {}\n\n  extensionAction.title = manifestAction.default_title || manifest.name\n\n  const iconPath = getIconPath(extension)\n  if (iconPath) extensionAction.icon = { path: iconPath }\n\n  if (manifestAction.default_popup) {\n    extensionAction.popup = manifestAction.default_popup\n  }\n\n  return extensionAction\n}\n\ninterface ExtensionActionStore extends Partial<ExtensionAction> {\n  tabs: { [key: string]: ExtensionAction }\n}\n\nexport class BrowserActionAPI {\n  private actionMap = new Map</* extensionId */ string, ExtensionActionStore>()\n  private popup?: PopupView\n\n  private observers: Set<Electron.WebContents> = new Set()\n  private queuedUpdate: boolean = false\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n\n    const getter =\n      (propName: ExtensionActionKey) =>\n      ({ extension }: ExtensionEvent, details: chrome.browserAction.TabDetails = {}) => {\n        const { tabId } = details\n        const action = this.getAction(extension.id)\n\n        let result\n\n        if (tabId) {\n          if (action.tabs[tabId]) {\n            result = action.tabs[tabId][propName]\n          } else {\n            result = action[propName]\n          }\n        } else {\n          result = action[propName]\n        }\n\n        return result\n      }\n\n    const setDetails = (\n      { extension }: ExtensionEvent,\n      details: any,\n      propName: ExtensionActionKey\n    ) => {\n      const { tabId } = details\n      let value = (details as any)[propName] || undefined\n\n      if (typeof value === 'undefined') {\n        const defaults = getBrowserActionDefaults(extension)\n        value = defaults ? defaults[propName] : value\n      }\n\n      const valueObj = { [propName]: value }\n      const action = this.getAction(extension.id)\n\n      if (tabId) {\n        const tabAction = action.tabs[tabId] || (action.tabs[tabId] = {})\n        Object.assign(tabAction, valueObj)\n      } else {\n        Object.assign(action, valueObj)\n      }\n\n      this.onUpdate()\n    }\n\n    const setter =\n      (propName: ExtensionActionKey) =>\n      (event: ExtensionEvent, details: chrome.browserAction.TabDetails) =>\n        setDetails(event, details, propName)\n\n    const handleProp = (prop: string, key: ExtensionActionKey) => {\n      handle(`browserAction.get${prop}`, getter(key))\n      handle(`browserAction.set${prop}`, setter(key))\n    }\n\n    handleProp('BadgeBackgroundColor', 'color')\n    handleProp('BadgeText', 'text')\n    handleProp('Title', 'title')\n    handleProp('Popup', 'popup')\n\n    // setIcon is unique in that it can pass in a variety of properties. Here we normalize them\n    // to use 'icon'.\n    handle(\n      'browserAction.setIcon',\n      (event, { tabId, ...details }: chrome.browserAction.TabIconDetails) => {\n        setDetails(event, { tabId, icon: details }, 'icon')\n        setDetails(event, { tabId, iconModified: Date.now() }, 'iconModified')\n      }\n    )\n\n    // browserAction preload API\n    const preloadOpts = { allowRemote: true, extensionContext: false }\n    handle('browserAction.getState', this.getState.bind(this), preloadOpts)\n    handle('browserAction.activate', this.activate.bind(this), preloadOpts)\n    handle(\n      'browserAction.addObserver',\n      (event) => {\n        const { sender: webContents } = event\n        this.observers.add(webContents)\n        webContents.once('destroyed', () => {\n          this.observers.delete(webContents)\n        })\n      },\n      preloadOpts\n    )\n    handle(\n      'browserAction.removeObserver',\n      (event) => {\n        const { sender: webContents } = event\n        this.observers.delete(webContents)\n      },\n      preloadOpts\n    )\n\n    this.ctx.store.on('active-tab-changed', () => {\n      this.onUpdate()\n    })\n\n    // Clear out tab details when removed\n    this.ctx.store.on('tab-removed', (tabId: number) => {\n      for (const [, actionDetails] of this.actionMap) {\n        if (actionDetails.tabs[tabId]) {\n          delete actionDetails.tabs[tabId]\n        }\n      }\n      this.onUpdate()\n    })\n\n    this.setupSession(this.ctx.session)\n  }\n\n  private setupSession(session: Electron.Session) {\n    session.on('extension-loaded', (event, extension) => {\n      this.processExtension(extension)\n    })\n\n    session.on('extension-unloaded', (event, extension) => {\n      this.removeActions(extension.id)\n    })\n\n    session.protocol.registerBufferProtocol('crx', this.handleCrxRequest)\n  }\n\n  private handleCrxRequest = (\n    request: Electron.ProtocolRequest,\n    callback: (response: Electron.ProtocolResponse) => void\n  ) => {\n    debug('%s', request.url)\n\n    let response: Electron.ProtocolResponse\n\n    try {\n      const url = new URL(request.url)\n      const { hostname: requestType } = url\n\n      switch (requestType) {\n        case 'extension-icon': {\n          const tabId = url.searchParams.get('tabId')\n\n          const fragments = url.pathname.split('/')\n          const extensionId = fragments[1]\n          const imageSize = parseInt(fragments[2], 10)\n          const resizeType = parseInt(fragments[3], 10) || ResizeType.Up\n\n          const extension = this.ctx.session.getExtension(extensionId)\n\n          let iconDetails: chrome.browserAction.TabIconDetails | undefined\n\n          const action = this.actionMap.get(extensionId)\n          if (action) {\n            iconDetails = (tabId && action.tabs[tabId]?.icon) || action.icon\n          }\n\n          let iconImage\n\n          if (extension && iconDetails) {\n            if (typeof iconDetails.path === 'string') {\n              const iconAbsPath = resolveExtensionPath(extension, iconDetails.path)\n              if (iconAbsPath) iconImage = nativeImage.createFromPath(iconAbsPath)\n            } else if (typeof iconDetails.path === 'object') {\n              const imagePath = matchSize(iconDetails.path, imageSize, resizeType)\n              const iconAbsPath = imagePath && resolveExtensionPath(extension, imagePath)\n              if (iconAbsPath) iconImage = nativeImage.createFromPath(iconAbsPath)\n            } else if (typeof iconDetails.imageData === 'string') {\n              iconImage = nativeImage.createFromDataURL(iconDetails.imageData)\n            } else if (typeof iconDetails.imageData === 'object') {\n              const imageData = matchSize(iconDetails.imageData as any, imageSize, resizeType)\n              iconImage = imageData ? nativeImage.createFromDataURL(imageData) : undefined\n            }\n          }\n\n          if (iconImage) {\n            response = {\n              statusCode: 200,\n              mimeType: 'image/png',\n              data: iconImage.toPNG(),\n            }\n          } else {\n            response = { statusCode: 400 }\n          }\n\n          break\n        }\n        default: {\n          response = { statusCode: 400 }\n        }\n      }\n    } catch (e) {\n      console.error(e)\n\n      response = {\n        statusCode: 500,\n      }\n    }\n\n    callback(response)\n  }\n\n  private getAction(extensionId: string) {\n    let action = this.actionMap.get(extensionId)\n    if (!action) {\n      action = { tabs: {} }\n      this.actionMap.set(extensionId, action)\n      this.onUpdate()\n    }\n\n    return action\n  }\n\n  // TODO: Make private for v4 major release.\n  removeActions(extensionId: string) {\n    if (this.actionMap.has(extensionId)) {\n      this.actionMap.delete(extensionId)\n    }\n\n    this.onUpdate()\n  }\n\n  private getPopupUrl(extensionId: string, tabId: number) {\n    const action = this.getAction(extensionId)\n    const popupPath = action.tabs[tabId]?.popup || action.popup || undefined\n\n    let url: string | undefined\n\n    // Allow absolute URLs\n    try {\n      url = popupPath && new URL(popupPath).href\n    } catch {}\n\n    // Fallback to relative path\n    if (!url) {\n      try {\n        url = popupPath && new URL(popupPath, `chrome-extension://${extensionId}`).href\n      } catch {}\n    }\n\n    return url\n  }\n\n  // TODO: Make private for v4 major release.\n  processExtension(extension: Electron.Extension) {\n    const defaultAction = getBrowserActionDefaults(extension)\n    if (defaultAction) {\n      const action = this.getAction(extension.id)\n      Object.assign(action, defaultAction)\n    }\n  }\n\n  private getState() {\n    // Get state without icon data.\n    const actions = Array.from(this.actionMap.entries()).map(([id, details]) => {\n      const { icon, tabs, ...rest } = details\n\n      const tabsInfo: { [key: string]: any } = {}\n\n      for (const tabId of Object.keys(tabs)) {\n        const { icon, ...rest } = tabs[tabId]\n        tabsInfo[tabId] = rest\n      }\n\n      return {\n        id,\n        tabs: tabsInfo,\n        ...rest,\n      }\n    })\n\n    const activeTab = this.ctx.store.getActiveTabOfCurrentWindow()\n    return { activeTabId: activeTab?.id, actions }\n  }\n\n  private activate({ sender }: ExtensionEvent, details: ActivateDetails) {\n    const { eventType, extensionId, tabId } = details\n\n    debug(\n      `activate [eventType: ${eventType}, extensionId: '${extensionId}', tabId: ${tabId}, senderId: ${sender.id}]`\n    )\n\n    switch (eventType) {\n      case 'click':\n        this.activateClick(details)\n        break\n      case 'contextmenu':\n        this.activateContextMenu(details)\n        break\n      default:\n        console.debug(`Ignoring unknown browserAction.activate event '${eventType}'`)\n    }\n  }\n\n  private activateClick(details: ActivateDetails) {\n    const { extensionId, tabId, anchorRect } = details\n\n    if (this.popup) {\n      const toggleExtension = !this.popup.isDestroyed() && this.popup.extensionId === extensionId\n      this.popup.destroy()\n      this.popup = undefined\n      if (toggleExtension) {\n        debug('skipping activate to close popup')\n        return\n      }\n    }\n\n    const tab =\n      tabId >= 0 ? this.ctx.store.getTabById(tabId) : this.ctx.store.getActiveTabOfCurrentWindow()\n    if (!tab) {\n      throw new Error(`Unable to get active tab`)\n    }\n\n    const popupUrl = this.getPopupUrl(extensionId, tab.id)\n\n    if (popupUrl) {\n      const win = this.ctx.store.tabToWindow.get(tab)\n      if (!win) {\n        throw new Error('Unable to get BrowserWindow from active tab')\n      }\n\n      this.popup = new PopupView({\n        extensionId,\n        session: this.ctx.session,\n        parent: win,\n        url: popupUrl,\n        anchorRect,\n      })\n\n      debug(`opened popup: ${popupUrl}`)\n\n      this.ctx.emit('browser-action-popup-created', this.popup)\n    } else {\n      debug(`dispatching onClicked for ${extensionId}`)\n\n      const tabDetails = this.ctx.store.tabDetailsCache.get(tab.id)\n      this.ctx.router.sendEvent(extensionId, 'browserAction.onClicked', tabDetails)\n    }\n  }\n\n  private activateContextMenu(details: ActivateDetails) {\n    const { extensionId, anchorRect } = details\n\n    const extension = this.ctx.session.getExtension(extensionId)\n    if (!extension) {\n      throw new Error(`Unregistered extension '${extensionId}'`)\n    }\n\n    const manifest = getExtensionManifest(extension)\n    const menu = new Menu()\n    const append = (opts: Electron.MenuItemConstructorOptions) => menu.append(new MenuItem(opts))\n    const appendSeparator = () => menu.append(new MenuItem({ type: 'separator' }))\n\n    append({\n      label: extension.name,\n      click: () => {\n        const homePageUrl =\n          manifest.homepage_url || `https://chrome.google.com/webstore/detail/${extension.id}`\n        this.ctx.store.createTab({ url: homePageUrl })\n      },\n    })\n\n    appendSeparator()\n\n    const contextMenuItems: MenuItem[] = this.ctx.store.buildMenuItems(\n      extensionId,\n      'browser_action'\n    )\n    if (contextMenuItems.length > 0) {\n      contextMenuItems.forEach((item) => menu.append(item))\n      appendSeparator()\n    }\n\n    const optionsPage = manifest.options_page || manifest.options_ui?.page\n    const optionsPageUrl = optionsPage ? getExtensionUrl(extension, optionsPage) : undefined\n\n    append({\n      label: 'Options',\n      enabled: typeof optionsPageUrl === 'string',\n      click: () => {\n        this.ctx.store.createTab({ url: optionsPageUrl })\n      },\n    })\n\n    if (process.env.NODE_ENV === 'development' && process.env.DEBUG) {\n      append({\n        label: 'Remove extension',\n        click: () => {\n          debug(`removing extension \"${extension.name}\" (${extension.id})`)\n          this.ctx.session.removeExtension(extension.id)\n        },\n      })\n    }\n\n    menu.popup({\n      x: Math.floor(anchorRect.x),\n      y: Math.floor(anchorRect.y + anchorRect.height),\n    })\n  }\n\n  private onUpdate() {\n    if (this.queuedUpdate) return\n    this.queuedUpdate = true\n    queueMicrotask(() => {\n      this.queuedUpdate = false\n      debug(`dispatching update to ${this.observers.size} observer(s)`)\n      Array.from(this.observers).forEach((observer) => {\n        if (!observer.isDestroyed()) {\n          observer.send('browserAction.update')\n        }\n      })\n    })\n  }\n}\n","import { ExtensionContext } from '../context'\n\n/**\n * Stub implementation for chrome.commands API.\n */\nexport class CommandsAPI {\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('commands.getAll', this.getAll)\n  }\n\n  getAll() {\n    return []\n  }\n}\n","import { promises as fs } from 'fs'\nimport * as path from 'path'\nimport { nativeImage } from 'electron'\n\nexport interface TabContents extends Electron.WebContents {\n  favicon?: string\n}\n\nexport type ContextMenuType =\n  | 'all'\n  | 'page'\n  | 'frame'\n  | 'selection'\n  | 'link'\n  | 'editable'\n  | 'image'\n  | 'video'\n  | 'audio'\n  | 'launcher'\n  | 'browser_action'\n  | 'page_action'\n  | 'action'\n\n/**\n * Get the extension's properly typed Manifest.\n *\n * I can't seem to get TS's merged type declarations working so I'm using this\n * instead for now.\n */\nexport const getExtensionManifest = (extension: Electron.Extension): chrome.runtime.Manifest =>\n  extension.manifest\n\nexport const getExtensionUrl = (extension: Electron.Extension, uri: string) => {\n  try {\n    return new URL(uri, extension.url).href\n  } catch {}\n}\n\nexport const resolveExtensionPath = (extension: Electron.Extension, uri: string) => {\n  const resPath = path.join(extension.path, uri)\n\n  // prevent any parent traversals\n  if (!resPath.startsWith(extension.path)) return\n\n  return resPath\n}\n\nexport const validateExtensionResource = async (extension: Electron.Extension, uri: string) => {\n  const resPath = resolveExtensionPath(extension, uri)\n  if (!resPath) return\n\n  try {\n    await fs.stat(resPath)\n  } catch {\n    return // doesn't exist\n  }\n\n  return resPath\n}\n\nexport enum ResizeType {\n  Exact,\n  Up,\n  Down,\n}\n\nexport const matchSize = (\n  imageSet: { [key: number]: string },\n  size: number,\n  match: ResizeType\n): string | undefined => {\n  // TODO: match based on size\n  const first = parseInt(Object.keys(imageSet).pop()!, 10)\n  return imageSet[first]\n}\n\n/** Gets the relative path to the extension's default icon. */\nexport const getIconPath = (\n  extension: Electron.Extension,\n  iconSize: number = 32,\n  resizeType = ResizeType.Up\n) => {\n  const { action, browser_action, icons } = getExtensionManifest(extension)\n  const { default_icon } = action || browser_action || {}\n\n  if (typeof default_icon === 'string') {\n    const iconPath = default_icon\n    return iconPath\n  } else if (typeof default_icon === 'object') {\n    const iconPath = matchSize(default_icon, iconSize, resizeType)\n    return iconPath\n  } else if (typeof icons === 'object') {\n    const iconPath = matchSize(icons, iconSize, resizeType)\n    return iconPath\n  }\n}\n\nexport const getIconImage = (extension: Electron.Extension) => {\n  const iconPath = getIconPath(extension)\n  const iconAbsolutePath = iconPath && resolveExtensionPath(extension, iconPath)\n  return iconAbsolutePath ? nativeImage.createFromPath(iconAbsolutePath) : undefined\n}\n\nconst escapePattern = (pattern: string) => pattern.replace(/[\\\\^$+?.()|[\\]{}]/g, '\\\\$&')\n\n/**\n * @see https://developer.chrome.com/extensions/match_patterns\n */\nexport const matchesPattern = (pattern: string, url: string) => {\n  if (pattern === '<all_urls>') return true\n  const regexp = new RegExp(`^${pattern.split('*').map(escapePattern).join('.*')}$`)\n  return url.match(regexp)\n}\n\nexport const matchesTitlePattern = (pattern: string, title: string) => {\n  const regexp = new RegExp(`^${pattern.split('*').map(escapePattern).join('.*')}$`)\n  return title.match(regexp)\n}\n","import { Menu, MenuItem } from 'electron'\nimport { MenuItemConstructorOptions } from 'electron/main'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { ContextMenuType, getIconImage, matchesPattern } from './common'\n\ntype ContextItemProps = chrome.contextMenus.CreateProperties & { id: string }\n\ntype ContextItemConstructorOptions = {\n  extension: Electron.Extension\n  props: ContextItemProps\n  webContents: Electron.WebContents\n  params?: Electron.ContextMenuParams\n  showIcon?: boolean\n}\n\nconst DEFAULT_CONTEXTS = ['page']\n\nconst getContextTypesFromParams = (params: Electron.ContextMenuParams): Set<ContextMenuType> => {\n  const contexts = new Set<ContextMenuType>(['all'])\n\n  switch (params.mediaType) {\n    case 'audio':\n    case 'video':\n    case 'image':\n      contexts.add(params.mediaType)\n  }\n\n  if (params.pageURL) contexts.add('page')\n  if (params.linkURL) contexts.add('link')\n  if (params.frameURL) contexts.add('frame')\n  if (params.selectionText) contexts.add('selection')\n  if (params.isEditable) contexts.add('editable')\n\n  return contexts\n}\n\nconst formatTitle = (title: string, params: Electron.ContextMenuParams) => {\n  if (params.selectionText && title.includes('%s')) {\n    title = title.split('%s').join(params.selectionText)\n  }\n  return title\n}\n\nconst matchesConditions = (\n  props: ContextItemProps,\n  conditions: {\n    contextTypes: Set<ContextMenuType>\n    targetUrl?: string\n    documentUrl?: string\n  }\n) => {\n  if (props.visible === false) return false\n\n  const { contextTypes, targetUrl, documentUrl } = conditions\n\n  const contexts = props.contexts || DEFAULT_CONTEXTS\n  const inContext = contexts.some((context) => contextTypes.has(context as ContextMenuType))\n  if (!inContext) return false\n\n  if (props.targetUrlPatterns && props.targetUrlPatterns.length > 0 && targetUrl) {\n    if (!props.targetUrlPatterns.some((pattern) => matchesPattern(pattern, targetUrl))) {\n      return false\n    }\n  }\n\n  if (props.documentUrlPatterns && props.documentUrlPatterns.length > 0 && documentUrl) {\n    if (!props.documentUrlPatterns.some((pattern) => matchesPattern(pattern, documentUrl))) {\n      return false\n    }\n  }\n\n  return true\n}\n\nexport class ContextMenusAPI {\n  private menus = new Map<\n    /* extensionId */ string,\n    Map</* menuItemId */ string, ContextItemProps>\n  >()\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('contextMenus.create', this.create)\n    handle('contextMenus.remove', this.remove)\n    handle('contextMenus.removeAll', this.removeAll)\n\n    this.ctx.session.on('extension-unloaded', (event, extension) => {\n      if (this.menus.has(extension.id)) {\n        this.menus.delete(extension.id)\n      }\n    })\n\n    this.ctx.store.buildMenuItems = this.buildMenuItemsForExtension.bind(this)\n  }\n\n  private addContextItem(extensionId: string, props: ContextItemProps) {\n    let contextItems = this.menus.get(extensionId)\n    if (!contextItems) {\n      contextItems = new Map()\n      this.menus.set(extensionId, contextItems)\n    }\n    contextItems.set(props.id, props)\n  }\n\n  private buildMenuItem = (opts: ContextItemConstructorOptions) => {\n    const { extension, props, webContents, params } = opts\n\n    // TODO: try to get the appropriately sized image before resizing\n    let icon = opts.showIcon ? getIconImage(extension) : undefined\n    if (icon) {\n      icon = icon.resize({ width: 16, height: 16 })\n    }\n\n    const menuItemOptions: MenuItemConstructorOptions = {\n      id: props.id,\n      type: props.type as any,\n      label: params ? formatTitle(props.title || '', params) : props.title || '',\n      icon,\n      enabled: props.enabled,\n      click: () => {\n        this.onClicked(extension.id, props.id, webContents, params)\n      },\n    }\n\n    return menuItemOptions\n  }\n\n  private buildMenuItemsFromTemplate = (menuItemTemplates: ContextItemConstructorOptions[]) => {\n    const itemMap = new Map<string, MenuItemConstructorOptions>()\n\n    // Group by ID\n    for (const item of menuItemTemplates) {\n      const menuItem = this.buildMenuItem(item)\n      itemMap.set(item.props.id, menuItem)\n    }\n\n    // Organize in tree\n    for (const item of menuItemTemplates) {\n      const menuItem = itemMap.get(item.props.id)\n      if (item.props.parentId) {\n        const parentMenuItem = itemMap.get(item.props.parentId)\n        if (parentMenuItem) {\n          const submenu = (parentMenuItem.submenu || []) as Electron.MenuItemConstructorOptions[]\n          submenu.push(menuItem!)\n          parentMenuItem.submenu = submenu\n        }\n      }\n    }\n\n    const menuItems: Electron.MenuItem[] = []\n\n    const buildFromTemplate = (opts: Electron.MenuItemConstructorOptions) => {\n      if (Array.isArray(opts.submenu)) {\n        const submenu = new Menu()\n        opts.submenu.forEach((item) => submenu.append(buildFromTemplate(item)))\n        opts.submenu = submenu\n      }\n      return new MenuItem(opts)\n    }\n\n    // Build all final MenuItems in-order\n    for (const item of menuItemTemplates) {\n      // Items with parents will be handled recursively\n      if (item.props.parentId) continue\n\n      const menuItem = itemMap.get(item.props.id)!\n      menuItems.push(buildFromTemplate(menuItem))\n    }\n\n    return menuItems\n  }\n\n  buildMenuItemsForParams(\n    webContents: Electron.WebContents,\n    params: Electron.ContextMenuParams\n  ): Electron.MenuItem[] {\n    if (webContents.session !== this.ctx.session) return []\n\n    let menuItemOptions: ContextItemConstructorOptions[] = []\n\n    const conditions = {\n      contextTypes: getContextTypesFromParams(params),\n      targetUrl: params.srcURL || params.linkURL,\n      documentUrl: params.frameURL || params.pageURL,\n    }\n\n    for (const [extensionId, propItems] of this.menus) {\n      const extension = this.ctx.session.getExtension(extensionId)\n      if (!extension) continue\n\n      const extensionMenuItemOptions: ContextItemConstructorOptions[] = []\n\n      for (const [, props] of propItems) {\n        if (matchesConditions(props, conditions)) {\n          const menuItem = {\n            extension,\n            props,\n            webContents,\n            params,\n          }\n          extensionMenuItemOptions.push(menuItem)\n        }\n      }\n\n      const topLevelItems = extensionMenuItemOptions.filter((opt) => !opt.props.parentId)\n\n      if (topLevelItems.length > 1) {\n        // Create new top-level item to group children\n        const groupId = `group${extension.id}`\n        const groupMenuItemOptions: ContextItemConstructorOptions = {\n          extension,\n          webContents,\n          props: {\n            id: groupId,\n            title: extension.name,\n          },\n          params,\n          showIcon: true,\n        }\n\n        // Reassign children to group item\n        const children = extensionMenuItemOptions.map((opt) =>\n          opt.props.parentId\n            ? opt\n            : {\n                ...opt,\n                props: {\n                  ...opt.props,\n                  parentId: groupId,\n                },\n              }\n        )\n\n        menuItemOptions = [...menuItemOptions, groupMenuItemOptions, ...children]\n      } else if (extensionMenuItemOptions.length > 0) {\n        // Set all children to show icon\n        const children = extensionMenuItemOptions.map((opt) => ({ ...opt, showIcon: true }))\n        menuItemOptions = [...menuItemOptions, ...children]\n      }\n    }\n\n    return this.buildMenuItemsFromTemplate(menuItemOptions)\n  }\n\n  private buildMenuItemsForExtension(\n    extensionId: string,\n    menuType: ContextMenuType\n  ): Electron.MenuItem[] {\n    const extensionItems = this.menus.get(extensionId)\n    const extension = this.ctx.session.getExtension(extensionId)\n    const activeTab = this.ctx.store.getActiveTabOfCurrentWindow()\n\n    const menuItemOptions = []\n\n    if (extensionItems && extension && activeTab) {\n      const conditions = {\n        contextTypes: new Set<ContextMenuType>(['all', menuType]),\n      }\n\n      for (const [, props] of extensionItems) {\n        if (matchesConditions(props, conditions)) {\n          const menuItem = { extension, props, webContents: activeTab }\n          menuItemOptions.push(menuItem)\n        }\n      }\n    }\n\n    return this.buildMenuItemsFromTemplate(menuItemOptions)\n  }\n\n  private create = ({ extension }: ExtensionEvent, createProperties: ContextItemProps) => {\n    const { id, type, title } = createProperties\n\n    if (this.menus.has(id)) {\n      // TODO: duplicate error\n      return\n    }\n\n    if (!title && type !== 'separator') {\n      // TODO: error\n      return\n    }\n\n    this.addContextItem(extension.id, createProperties)\n  }\n\n  private remove = ({ extension }: ExtensionEvent, menuItemId: string) => {\n    const items = this.menus.get(extension.id)\n    if (items && items.has(menuItemId)) {\n      items.delete(menuItemId)\n      if (items.size === 0) {\n        this.menus.delete(extension.id)\n      }\n    }\n  }\n\n  private removeAll = ({ extension }: ExtensionEvent) => {\n    this.menus.delete(extension.id)\n  }\n\n  private onClicked(\n    extensionId: string,\n    menuItemId: string,\n    webContents: Electron.WebContents,\n    params?: Electron.ContextMenuParams\n  ) {\n    if (webContents.isDestroyed()) return\n\n    const tab = this.ctx.store.tabDetailsCache.get(webContents.id)\n    if (!tab) {\n      console.error(`[Extensions] Unable to find tab for id=${webContents.id}`)\n      return\n    }\n\n    const data: chrome.contextMenus.OnClickData = {\n      selectionText: params?.selectionText,\n      checked: false, // TODO\n      menuItemId,\n      frameId: -1, // TODO: match frameURL with webFrameMain in Electron 12\n      frameUrl: params?.frameURL,\n      editable: params?.isEditable || false,\n      mediaType: params?.mediaType,\n      wasChecked: false, // TODO\n      pageUrl: params?.pageURL as any, // types are inaccurate\n      linkUrl: params?.linkURL,\n      parentMenuItemId: -1, // TODO\n      srcUrl: params?.srcURL,\n    }\n\n    this.ctx.router.sendEvent(extensionId, 'contextMenus.onClicked', data, tab)\n  }\n}\n","import { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\n\nenum CookieStoreID {\n  Default = '0',\n  Incognito = '1',\n}\n\nconst onChangedCauseTranslation: { [key: string]: string } = {\n  'expired-overwrite': 'expired_overwrite',\n}\n\nconst createCookieDetails = (cookie: Electron.Cookie): chrome.cookies.Cookie => ({\n  ...cookie,\n  domain: cookie.domain || '',\n  hostOnly: Boolean(cookie.hostOnly),\n  session: Boolean(cookie.session),\n  path: cookie.path || '',\n  httpOnly: Boolean(cookie.httpOnly),\n  secure: Boolean(cookie.secure),\n  storeId: CookieStoreID.Default,\n})\n\nexport class CookiesAPI {\n  private get cookies() {\n    return this.ctx.session.cookies\n  }\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('cookies.get', this.get.bind(this))\n    handle('cookies.getAll', this.getAll.bind(this))\n    handle('cookies.set', this.set.bind(this))\n    handle('cookies.remove', this.remove.bind(this))\n    handle('cookies.getAllCookieStores', this.getAllCookieStores.bind(this))\n\n    this.cookies.addListener('changed', this.onChanged)\n  }\n\n  private async get(\n    event: ExtensionEvent,\n    details: chrome.cookies.Details\n  ): Promise<chrome.cookies.Cookie | null> {\n    // TODO: storeId\n    const cookies = await this.cookies.get({\n      url: details.url,\n      name: details.name,\n    })\n\n    // TODO: If more than one cookie of the same name exists for the given URL,\n    // the one with the longest path will be returned. For cookies with the\n    // same path length, the cookie with the earliest creation time will be returned.\n    return cookies.length > 0 ? createCookieDetails(cookies[0]) : null\n  }\n\n  private async getAll(\n    event: ExtensionEvent,\n    details: chrome.cookies.GetAllDetails\n  ): Promise<chrome.cookies.Cookie[]> {\n    // TODO: storeId\n    const cookies = await this.cookies.get({\n      url: details.url,\n      name: details.name,\n      domain: details.domain,\n      path: details.path,\n      secure: details.secure,\n      session: details.session,\n    })\n\n    return cookies.map(createCookieDetails)\n  }\n\n  private async set(\n    event: ExtensionEvent,\n    details: chrome.cookies.SetDetails\n  ): Promise<chrome.cookies.Cookie | null> {\n    await this.cookies.set(details)\n    const cookies = await this.cookies.get(details)\n    return cookies.length > 0 ? createCookieDetails(cookies[0]) : null\n  }\n\n  private async remove(\n    event: ExtensionEvent,\n    details: chrome.cookies.Details\n  ): Promise<chrome.cookies.Details | null> {\n    try {\n      await this.cookies.remove(details.url, details.name)\n    } catch {\n      return null\n    }\n    return details\n  }\n\n  private async getAllCookieStores(event: ExtensionEvent): Promise<chrome.cookies.CookieStore[]> {\n    const tabIds = Array.from(this.ctx.store.tabs)\n      .map((tab) => (tab.isDestroyed() ? undefined : tab.id))\n      .filter(Boolean) as number[]\n    return [{ id: CookieStoreID.Default, tabIds }]\n  }\n\n  private onChanged = (event: Electron.Event, cookie: Electron.Cookie, cause: string, removed: boolean) => {\n    const changeInfo: chrome.cookies.CookieChangeInfo = {\n      cause: onChangedCauseTranslation[cause] || cause,\n      cookie: createCookieDetails(cookie),\n      removed,\n    }\n\n    this.ctx.router.broadcastEvent('cookies.onChanged', changeInfo)\n  }\n}\n","import { app, Extension, Notification } from 'electron'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { validateExtensionResource } from './common'\n\nenum TemplateType {\n  Basic = 'basic',\n  Image = 'image',\n  List = 'list',\n  Progress = 'progress',\n}\n\nconst getBody = (opts: chrome.notifications.NotificationOptions) => {\n  const { type = TemplateType.Basic } = opts\n\n  switch (type) {\n    case TemplateType.List: {\n      if (!Array.isArray(opts.items)) {\n        throw new Error('List items must be provided for list type')\n      }\n      return opts.items.map((item) => `${item.title} - ${item.message}`).join('\\n')\n    }\n    default:\n      return opts.message || ''\n  }\n}\n\nconst getUrgency = (\n  priority?: number\n): Required<Electron.NotificationConstructorOptions>['urgency'] => {\n  if (typeof priority !== 'number') {\n    return 'normal'\n  } else if (priority >= 2) {\n    return 'critical'\n  } else if (priority < 0) {\n    return 'low'\n  } else {\n    return 'normal'\n  }\n}\n\nconst createScopedIdentifier = (extension: Extension, id: string) => `${extension.id}-${id}`\nconst stripScopeFromIdentifier = (id: string) => {\n  const index = id.indexOf('-')\n  return id.substr(index + 1)\n}\n\nexport class NotificationsAPI {\n  private registry = new Map<string, Notification>()\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('notifications.clear', this.clear)\n    handle('notifications.create', this.create)\n    handle('notifications.getAll', this.getAll)\n    handle('notifications.getPermissionLevel', this.getPermissionLevel)\n    handle('notifications.update', this.update)\n\n    this.ctx.session.on('extension-unloaded', (event, extension) => {\n      for (const [key, notification] of this.registry) {\n        if (key.startsWith(extension.id)) {\n          notification.close()\n        }\n      }\n    })\n  }\n\n  private clear = ({ extension }: ExtensionEvent, id: string) => {\n    const notificationId = createScopedIdentifier(extension, id)\n    if (this.registry.has(notificationId)) {\n      this.registry.get(notificationId)?.close()\n    }\n  }\n\n  private create = async ({ extension }: ExtensionEvent, arg1: unknown, arg2?: unknown) => {\n    let id: string\n    let opts: chrome.notifications.NotificationOptions\n\n    if (typeof arg1 === 'object') {\n      id = 'guid' // TODO: generate uuid\n      opts = arg1 as chrome.notifications.NotificationOptions\n    } else if (typeof arg1 === 'string') {\n      id = arg1\n      opts = arg2 as chrome.notifications.NotificationOptions\n    } else {\n      throw new Error('Invalid arguments')\n    }\n\n    if (typeof opts !== 'object' || !opts.type || !opts.iconUrl || !opts.title || !opts.message) {\n      throw new Error('Missing required notification options')\n    }\n\n    const notificationId = createScopedIdentifier(extension, id)\n\n    if (this.registry.has(notificationId)) {\n      this.registry.get(notificationId)?.close()\n    }\n\n    let icon\n\n    if (opts.iconUrl) {\n      let url\n      try {\n        url = new URL(opts.iconUrl)\n      } catch {}\n\n      if (url?.protocol === 'data:') {\n        icon = opts.iconUrl\n      } else {\n        icon = await validateExtensionResource(extension, opts.iconUrl)\n      }\n\n      if (!icon) {\n        throw new Error('Invalid iconUrl')\n      }\n    }\n\n    // TODO: buttons, template types\n\n    const notification = new Notification({\n      title: opts.title,\n      subtitle: app.name,\n      body: getBody(opts),\n      silent: opts.silent,\n      icon,\n      urgency: getUrgency(opts.priority),\n      timeoutType: opts.requireInteraction ? 'never' : 'default',\n    })\n\n    this.registry.set(notificationId, notification)\n\n    notification.on('click', () => {\n      this.ctx.router.sendEvent(extension.id, 'notifications.onClicked', id)\n    })\n\n    notification.once('close', () => {\n      const byUser = true // TODO\n      this.ctx.router.sendEvent(extension.id, 'notifications.onClosed', id, byUser)\n      this.registry.delete(notificationId)\n    })\n\n    notification.show()\n\n    return id\n  }\n\n  private getAll = ({ extension }: ExtensionEvent) => {\n    return Array.from(this.registry.keys())\n      .filter((key) => key.startsWith(extension.id))\n      .map(stripScopeFromIdentifier)\n  }\n\n  private getPermissionLevel = (event: ExtensionEvent) => {\n    return Notification.isSupported() ? 'granted' : 'denied'\n  }\n\n  private update = (\n    { extension }: ExtensionEvent,\n    id: string,\n    opts: chrome.notifications.NotificationOptions\n  ) => {\n    const notificationId = createScopedIdentifier(extension, id)\n\n    const notification = this.registry.get(notificationId)\n\n    if (!notification) {\n      return false\n    }\n\n    // TODO: remaining opts\n\n    if (opts.priority) notification.urgency = getUrgency(opts.priority)\n    if (opts.silent) notification.silent = opts.silent\n  }\n}\n","import { EventEmitter } from 'events'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { getExtensionManifest } from './common'\n\nexport class RuntimeAPI extends EventEmitter {\n  constructor(private ctx: ExtensionContext) {\n    super()\n\n    const handle = this.ctx.router.apiHandler()\n    handle('runtime.openOptionsPage', this.openOptionsPage)\n  }\n\n  private openOptionsPage = async ({ extension }: ExtensionEvent) => {\n    // TODO: options page shouldn't appear in Tabs API\n    // https://developer.chrome.com/extensions/options#tabs-api\n\n    const manifest = getExtensionManifest(extension)\n\n    if (manifest.options_ui) {\n      // Embedded option not support (!options_ui.open_in_new_tab)\n      const url = `chrome-extension://${extension.id}/${manifest.options_ui.page}`\n      await this.ctx.store.createTab({ url, active: true })\n    } else if (manifest.options_page) {\n      const url = `chrome-extension://${extension.id}/${manifest.options_page}`\n      await this.ctx.store.createTab({ url, active: true })\n    }\n  }\n}\n","import { BrowserWindow } from 'electron'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { matchesPattern, matchesTitlePattern, TabContents } from './common'\nimport { WindowsAPI } from './windows'\n\nconst debug = require('debug')('electron-chrome-extensions:tabs')\n\nconst validateExtensionUrl = (url: string, extension: Electron.Extension) => {\n  // Convert relative URLs to absolute if needed\n  try {\n    url = new URL(url, extension.url).href\n  } catch (e) {\n    throw new Error('Invalid URL')\n  }\n\n  // Prevent creating chrome://kill or other debug commands\n  if (url.startsWith('chrome:') || url.startsWith('javascript:')) {\n    throw new Error('Invalid URL')\n  }\n\n  return url\n}\n\nexport class TabsAPI {\n  static TAB_ID_NONE = -1\n  static WINDOW_ID_NONE = -1\n  static WINDOW_ID_CURRENT = -2\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('tabs.get', this.get.bind(this))\n    handle('tabs.getAllInWindow', this.getAllInWindow.bind(this))\n    handle('tabs.getCurrent', this.getCurrent.bind(this))\n    handle('tabs.create', this.create.bind(this))\n    handle('tabs.insertCSS', this.insertCSS.bind(this))\n    handle('tabs.query', this.query.bind(this))\n    handle('tabs.reload', this.reload.bind(this))\n    handle('tabs.update', this.update.bind(this))\n    handle('tabs.remove', this.remove.bind(this))\n    handle('tabs.goForward', this.goForward.bind(this))\n    handle('tabs.goBack', this.goBack.bind(this))\n\n    this.ctx.store.on('tab-added', this.observeTab.bind(this))\n  }\n\n  private observeTab(tab: TabContents) {\n    const tabId = tab.id\n\n    const updateEvents = [\n      'page-title-updated', // title\n      'did-start-loading', // status\n      'did-stop-loading', // status\n      'media-started-playing', // audible\n      'media-paused', // audible\n      'did-start-navigation', // url\n      'did-redirect-navigation', // url\n      'did-navigate-in-page', // url\n    ]\n\n    const updateHandler = () => {\n      this.onUpdated(tabId)\n    }\n\n    updateEvents.forEach((eventName) => {\n      tab.on(eventName as any, updateHandler)\n    })\n\n    const faviconHandler = (event: Electron.Event, favicons: string[]) => {\n      ;(tab as TabContents).favicon = favicons[0]\n      this.onUpdated(tabId)\n    }\n    tab.on('page-favicon-updated', faviconHandler)\n\n    tab.once('destroyed', () => {\n      updateEvents.forEach((eventName) => {\n        tab.off(eventName as any, updateHandler)\n      })\n      tab.off('page-favicon-updated', faviconHandler)\n\n      this.ctx.store.removeTab(tab)\n      this.onRemoved(tabId)\n    })\n\n    this.onCreated(tabId)\n    this.onActivated(tabId)\n\n    debug(`Observing tab[${tabId}][${tab.getType()}] ${tab.getURL()}`)\n  }\n\n  private createTabDetails(tab: TabContents) {\n    const tabId = tab.id\n    const activeTab = this.ctx.store.getActiveTabFromWebContents(tab)\n    let win = this.ctx.store.tabToWindow.get(tab)\n    if (win?.isDestroyed()) win = undefined\n    const [width = 0, height = 0] = win ? win.getSize() : []\n\n    const details: chrome.tabs.Tab = {\n      active: activeTab?.id === tabId,\n      audible: tab.isCurrentlyAudible(),\n      autoDiscardable: true,\n      discarded: false,\n      favIconUrl: tab.favicon || undefined,\n      height,\n      highlighted: false,\n      id: tabId,\n      incognito: false,\n      index: -1, // TODO\n      mutedInfo: { muted: tab.audioMuted },\n      pinned: false,\n      selected: true,\n      status: tab.isLoading() ? 'loading' : 'complete',\n      title: tab.getTitle(),\n      url: tab.getURL(), // TODO: tab.mainFrame.url (Electron 12)\n      width,\n      windowId: win ? win.id : -1,\n    }\n\n    if (typeof this.ctx.store.impl.assignTabDetails === 'function') {\n      this.ctx.store.impl.assignTabDetails(details, tab)\n    }\n\n    this.ctx.store.tabDetailsCache.set(tab.id, details)\n    return details\n  }\n\n  private getTabDetails(tab: TabContents) {\n    if (this.ctx.store.tabDetailsCache.has(tab.id)) {\n      return this.ctx.store.tabDetailsCache.get(tab.id)\n    }\n    const details = this.createTabDetails(tab)\n    return details\n  }\n\n  private get(event: ExtensionEvent, tabId: number) {\n    const tab = this.ctx.store.getTabById(tabId)\n    if (!tab) return { id: TabsAPI.TAB_ID_NONE }\n    return this.getTabDetails(tab)\n  }\n\n  private getAllInWindow(event: ExtensionEvent, windowId: number = TabsAPI.WINDOW_ID_CURRENT) {\n    if (windowId === TabsAPI.WINDOW_ID_CURRENT) windowId = this.ctx.store.lastFocusedWindowId!\n\n    const tabs = Array.from(this.ctx.store.tabs).filter((tab) => {\n      if (tab.isDestroyed()) return false\n\n      const browserWindow = this.ctx.store.tabToWindow.get(tab)\n      if (!browserWindow || browserWindow.isDestroyed()) return\n\n      return browserWindow.id === windowId\n    })\n\n    return tabs.map(this.getTabDetails.bind(this))\n  }\n\n  private getCurrent(event: ExtensionEvent) {\n    const tab = this.ctx.store.getActiveTabOfCurrentWindow()\n    return tab ? this.getTabDetails(tab) : undefined\n  }\n\n  private async create(event: ExtensionEvent, details: chrome.tabs.CreateProperties = {}) {\n    const url = details.url ? validateExtensionUrl(details.url, event.extension) : undefined\n    const tab = await this.ctx.store.createTab({ ...details, url })\n    const tabDetails = this.getTabDetails(tab)\n    if (details.active) {\n      queueMicrotask(() => this.onActivated(tab.id))\n    }\n    return tabDetails\n  }\n\n  private insertCSS(event: ExtensionEvent, tabId: number, details: chrome.tabs.InjectDetails) {\n    const tab = this.ctx.store.getTabById(tabId)\n    if (!tab) return\n\n    // TODO: move to webFrame in renderer?\n    if (details.code) {\n      tab.insertCSS(details.code)\n    }\n  }\n\n  private query(event: ExtensionEvent, info: chrome.tabs.QueryInfo = {}) {\n    const isSet = (value: any) => typeof value !== 'undefined'\n\n    const filteredTabs = Array.from(this.ctx.store.tabs)\n      .map(this.getTabDetails.bind(this))\n      .filter((tab) => {\n        if (!tab) return false\n        if (isSet(info.active) && info.active !== tab.active) return false\n        if (isSet(info.pinned) && info.pinned !== tab.pinned) return false\n        if (isSet(info.audible) && info.audible !== tab.audible) return false\n        if (isSet(info.muted) && info.muted !== tab.mutedInfo?.muted) return false\n        if (isSet(info.highlighted) && info.highlighted !== tab.highlighted) return false\n        if (isSet(info.discarded) && info.discarded !== tab.discarded) return false\n        if (isSet(info.autoDiscardable) && info.autoDiscardable !== tab.autoDiscardable)\n          return false\n        // if (isSet(info.currentWindow)) return false\n        // if (isSet(info.lastFocusedWindow)) return false\n        if (isSet(info.status) && info.status !== tab.status) return false\n        if (isSet(info.title) && typeof info.title === 'string' && typeof tab.title === 'string') {\n          if (!matchesTitlePattern(info.title, tab.title)) return false\n        }\n        if (isSet(info.url) && typeof tab.url === 'string') {\n          if (typeof info.url === 'string' && !matchesPattern(info.url, tab.url!)) {\n            return false\n          } else if (\n            Array.isArray(info.url) &&\n            !info.url.some((pattern) => matchesPattern(pattern, tab.url!))\n          ) {\n            return false\n          }\n        }\n        if (isSet(info.windowId)) {\n          if (info.windowId === TabsAPI.WINDOW_ID_CURRENT) {\n            if (this.ctx.store.lastFocusedWindowId !== tab.windowId) return false\n          } else if (info.windowId !== tab.windowId) {\n            return false\n          }\n        }\n        // if (isSet(info.windowType) && info.windowType !== tab.windowType) return false\n        // if (isSet(info.index) && info.index !== tab.index) return false\n        return true\n      })\n      .map((tab, index) => {\n        if (tab) {\n          tab.index = index\n        }\n        return tab\n      })\n    return filteredTabs\n  }\n\n  private reload(event: ExtensionEvent, arg1?: unknown, arg2?: unknown) {\n    const tabId: number | undefined = typeof arg1 === 'number' ? arg1 : undefined\n    const reloadProperties: chrome.tabs.ReloadProperties | null =\n      typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : {}\n\n    const tab = tabId\n      ? this.ctx.store.getTabById(tabId)\n      : this.ctx.store.getActiveTabOfCurrentWindow()\n    if (!tab) return\n\n    if (reloadProperties?.bypassCache) {\n      tab.reloadIgnoringCache()\n    } else {\n      tab.reload()\n    }\n  }\n\n  private async update(event: ExtensionEvent, arg1?: unknown, arg2?: unknown) {\n    let tabId = typeof arg1 === 'number' ? arg1 : undefined\n    const updateProperties: chrome.tabs.UpdateProperties =\n      (typeof arg1 === 'object' ? (arg1 as any) : (arg2 as any)) || {}\n\n    const tab = tabId\n      ? this.ctx.store.getTabById(tabId)\n      : this.ctx.store.getActiveTabOfCurrentWindow()\n    if (!tab) return\n\n    tabId = tab.id\n\n    const props = updateProperties\n\n    const url = props.url ? validateExtensionUrl(props.url, event.extension) : undefined\n    if (url) await tab.loadURL(url)\n\n    if (typeof props.muted === 'boolean') tab.setAudioMuted(props.muted)\n\n    if (props.active) this.onActivated(tabId)\n\n    this.onUpdated(tabId)\n\n    return this.createTabDetails(tab)\n  }\n\n  private remove(event: ExtensionEvent, id: number | number[]) {\n    const ids = Array.isArray(id) ? id : [id]\n\n    ids.forEach((tabId) => {\n      const tab = this.ctx.store.getTabById(tabId)\n      if (tab) this.ctx.store.removeTab(tab)\n      this.onRemoved(tabId)\n    })\n  }\n\n  private goForward(event: ExtensionEvent, arg1?: unknown) {\n    const tabId = typeof arg1 === 'number' ? arg1 : undefined\n    const tab = tabId\n      ? this.ctx.store.getTabById(tabId)\n      : this.ctx.store.getActiveTabOfCurrentWindow()\n    if (!tab) return\n    tab.goForward()\n  }\n\n  private goBack(event: ExtensionEvent, arg1?: unknown) {\n    const tabId = typeof arg1 === 'number' ? arg1 : undefined\n    const tab = tabId\n      ? this.ctx.store.getTabById(tabId)\n      : this.ctx.store.getActiveTabOfCurrentWindow()\n    if (!tab) return\n    tab.goBack()\n  }\n\n  onCreated(tabId: number) {\n    const tab = this.ctx.store.getTabById(tabId)\n    if (!tab) return\n    const tabDetails = this.getTabDetails(tab)\n    this.ctx.router.broadcastEvent('tabs.onCreated', tabDetails)\n  }\n\n  onUpdated(tabId: number) {\n    const tab = this.ctx.store.getTabById(tabId)\n    if (!tab) return\n\n    let prevDetails\n    if (this.ctx.store.tabDetailsCache.has(tab.id)) {\n      prevDetails = this.ctx.store.tabDetailsCache.get(tab.id)\n    }\n    if (!prevDetails) return\n\n    const details = this.createTabDetails(tab)\n\n    const compareProps: (keyof chrome.tabs.Tab)[] = [\n      'status',\n      'url',\n      'pinned',\n      'audible',\n      'discarded',\n      'autoDiscardable',\n      'mutedInfo',\n      'favIconUrl',\n      'title',\n    ]\n\n    let didUpdate = false\n    const changeInfo: chrome.tabs.TabChangeInfo = {}\n\n    for (const prop of compareProps) {\n      if (details[prop] !== prevDetails[prop]) {\n        ;(changeInfo as any)[prop] = details[prop]\n        didUpdate = true\n      }\n    }\n\n    if (!didUpdate) return\n\n    this.ctx.router.broadcastEvent('tabs.onUpdated', tab.id, changeInfo, details)\n  }\n\n  onRemoved(tabId: number) {\n    const details = this.ctx.store.tabDetailsCache.has(tabId)\n      ? this.ctx.store.tabDetailsCache.get(tabId)\n      : null\n    this.ctx.store.tabDetailsCache.delete(tabId)\n\n    const windowId = details ? details.windowId : WindowsAPI.WINDOW_ID_NONE\n    const win =\n      typeof windowId !== 'undefined' && windowId > -1\n        ? BrowserWindow.getAllWindows().find((win) => win.id === windowId)\n        : null\n\n    this.ctx.router.broadcastEvent('tabs.onRemoved', tabId, {\n      windowId,\n      isWindowClosing: win ? win.isDestroyed() : false,\n    })\n  }\n\n  onActivated(tabId: number) {\n    const tab = this.ctx.store.getTabById(tabId)\n    if (!tab) return\n\n    const activeTab = this.ctx.store.getActiveTabFromWebContents(tab)\n    const activeChanged = activeTab?.id !== tabId\n    if (!activeChanged) return\n\n    const win = this.ctx.store.tabToWindow.get(tab)\n\n    this.ctx.store.setActiveTab(tab)\n\n    // invalidate cache since 'active' has changed\n    this.ctx.store.tabDetailsCache.forEach((tabInfo, cacheTabId) => {\n      tabInfo.active = tabId === cacheTabId\n    })\n\n    this.ctx.router.broadcastEvent('tabs.onActivated', {\n      tabId,\n      windowId: win?.id,\n    })\n  }\n}\n","import * as electron from 'electron'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\n\nconst debug = require('debug')('electron-chrome-extensions:webNavigation')\n\n// https://github.com/electron/electron/pull/25464\nconst getFrame = (frameProcessId: number, frameRoutingId: number) => {\n  return (\n    ('webFrameMain' in electron &&\n      (electron as any).webFrameMain.fromId(frameProcessId, frameRoutingId)) ||\n    null\n  )\n}\n\nconst getFrameId = (frame: any) =>\n  'webFrameMain' in electron ? (frame === frame.top ? 0 : frame.frameTreeNodeId) : -1\n\nconst getParentFrameId = (frame: any) => {\n  const parentFrame = frame?.parent\n  return parentFrame ? getFrameId(parentFrame) : -1\n}\n\nconst getFrameDetails = (frame: any) => ({\n  errorOccurred: false, // TODO\n  processId: frame.processId,\n  frameId: getFrameId(frame),\n  parentFrameId: getParentFrameId(frame),\n  url: frame.url,\n})\n\nexport class WebNavigationAPI {\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('webNavigation.getFrame', this.getFrame.bind(this))\n    handle('webNavigation.getAllFrames', this.getAllFrames.bind(this))\n\n    this.ctx.store.on('tab-added', this.observeTab.bind(this))\n  }\n\n  private observeTab(tab: Electron.WebContents) {\n    tab.once('will-navigate', this.onCreatedNavigationTarget.bind(this, tab))\n    tab.on('did-start-navigation', this.onBeforeNavigate.bind(this, tab))\n    tab.on('did-frame-finish-load', this.onFinishLoad.bind(this, tab))\n    tab.on('did-frame-navigate', this.onCommitted.bind(this, tab))\n    tab.on('did-navigate-in-page', this.onHistoryStateUpdated.bind(this, tab))\n\n    tab.on('frame-created', (e, { frame }) => {\n      if (frame.top === frame) return\n\n      frame.on('dom-ready', () => {\n        this.onDOMContentLoaded(tab, frame)\n      })\n    })\n\n    // Main frame dom-ready event\n    tab.on('dom-ready', () => {\n      if ('mainFrame' in tab) {\n        this.onDOMContentLoaded(tab, tab.mainFrame)\n      }\n    })\n  }\n\n  private getFrame(\n    event: ExtensionEvent,\n    details: chrome.webNavigation.GetFrameDetails\n  ): chrome.webNavigation.GetFrameResultDetails | null {\n    const tab = this.ctx.store.getTabById(details.tabId)\n    if (!tab) return null\n\n    let targetFrame: any\n\n    if (typeof details.frameId === 'number') {\n      // https://github.com/electron/electron/pull/25464\n      if ('mainFrame' in tab) {\n        const mainFrame = (tab as any).mainFrame\n        targetFrame = mainFrame.framesInSubtree.find((frame: any) => {\n          const isMainFrame = frame === frame.top\n          return isMainFrame ? details.frameId === 0 : details.frameId === frame.frameTreeNodeId\n        })\n      }\n    }\n\n    return targetFrame ? getFrameDetails(targetFrame) : null\n  }\n\n  private getAllFrames(\n    event: ExtensionEvent,\n    details: chrome.webNavigation.GetFrameDetails\n  ): chrome.webNavigation.GetAllFrameResultDetails[] | null {\n    const tab = this.ctx.store.getTabById(details.tabId)\n    if (!tab || !('mainFrame' in tab)) return []\n    return (tab as any).mainFrame.framesInSubtree.map(getFrameDetails)\n  }\n\n  private sendNavigationEvent = (eventName: string, details: { url: string }) => {\n    debug(`${eventName} [url: ${details.url}]`)\n    this.ctx.router.broadcastEvent(`webNavigation.${eventName}`, details)\n  }\n\n  private onCreatedNavigationTarget = (\n    tab: Electron.WebContents,\n    event: Electron.Event<Electron.WebContentsWillNavigateEventParams>,\n    ...args: any[]\n  ) => {\n    // Defaults for backwards compat prior to electron@25.0.0\n    const { url = args[0] as string, frame = getFrame(args[3], args[4]) as Electron.WebFrameMain } =\n      event\n\n    const details: chrome.webNavigation.WebNavigationSourceCallbackDetails = {\n      sourceTabId: tab.id,\n      sourceProcessId: frame ? frame.processId : -1,\n      sourceFrameId: getFrameId(frame),\n      url,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n    }\n    this.sendNavigationEvent('onCreatedNavigationTarget', details)\n  }\n\n  private onBeforeNavigate = (\n    tab: Electron.WebContents,\n    event: Electron.Event<Electron.WebContentsDidStartNavigationEventParams>,\n    ...args: any[]\n  ) => {\n    // Defaults for backwards compat prior to electron@25.0.0\n    const {\n      url = args[0] as string,\n      isSameDocument = args[1] as boolean,\n      frame = getFrame(args[3], args[4]) as Electron.WebFrameMain,\n    } = event\n\n    if (isSameDocument) return\n\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\n      frameId: getFrameId(frame),\n      parentFrameId: getParentFrameId(frame),\n      processId: frame ? frame.processId : -1,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n      url,\n    }\n\n    this.sendNavigationEvent('onBeforeNavigate', details)\n  }\n\n  private onCommitted = (\n    tab: Electron.WebContents,\n    event: Electron.Event,\n    url: string,\n    httpResponseCode: number,\n    httpStatusText: string,\n    isMainFrame: boolean,\n    frameProcessId: number,\n    frameRoutingId: number\n  ) => {\n    const frame = getFrame(frameProcessId, frameRoutingId)\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\n      frameId: getFrameId(frame),\n      parentFrameId: getParentFrameId(frame),\n      processId: frameProcessId,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n      url,\n    }\n    this.sendNavigationEvent('onCommitted', details)\n  }\n\n  private onHistoryStateUpdated = (\n    tab: Electron.WebContents,\n    event: Electron.Event,\n    url: string,\n    isMainFrame: boolean,\n    frameProcessId: number,\n    frameRoutingId: number\n  ) => {\n    const frame = getFrame(frameProcessId, frameRoutingId)\n    const details: chrome.webNavigation.WebNavigationTransitionCallbackDetails & {\n      parentFrameId: number\n    } = {\n      transitionType: '', // TODO\n      transitionQualifiers: [], // TODO\n      frameId: getFrameId(frame),\n      parentFrameId: getParentFrameId(frame),\n      processId: frameProcessId,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n      url,\n    }\n    this.sendNavigationEvent('onHistoryStateUpdated', details)\n  }\n\n  private onDOMContentLoaded = (tab: Electron.WebContents, frame: Electron.WebFrameMain) => {\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\n      frameId: getFrameId(frame),\n      parentFrameId: getParentFrameId(frame),\n      processId: frame.processId,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n      url: frame.url,\n    }\n    this.sendNavigationEvent('onDOMContentLoaded', details)\n\n    if (!tab.isLoadingMainFrame()) {\n      this.sendNavigationEvent('onCompleted', details)\n    }\n  }\n\n  private onFinishLoad = (\n    tab: Electron.WebContents,\n    event: Electron.Event,\n    isMainFrame: boolean,\n    frameProcessId: number,\n    frameRoutingId: number\n  ) => {\n    const frame = getFrame(frameProcessId, frameRoutingId)\n    const url = tab.getURL()\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\n      frameId: getFrameId(frame),\n      parentFrameId: getParentFrameId(frame),\n      processId: frameProcessId,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n      url,\n    }\n    this.sendNavigationEvent('onCompleted', details)\n  }\n}\n","import { BrowserWindow } from 'electron'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\n\nconst debug = require('debug')('electron-chrome-extensions:windows')\n\nconst getWindowState = (win: BrowserWindow): chrome.windows.Window['state'] => {\n  if (win.isMaximized()) return 'maximized'\n  if (win.isMinimized()) return 'minimized'\n  if (win.isFullScreen()) return 'fullscreen'\n  return 'normal'\n}\n\nexport class WindowsAPI {\n  static WINDOW_ID_NONE = -1\n  static WINDOW_ID_CURRENT = -2\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('windows.get', this.get.bind(this))\n    // TODO: how does getCurrent differ from getLastFocused?\n    handle('windows.getCurrent', this.getLastFocused.bind(this))\n    handle('windows.getLastFocused', this.getLastFocused.bind(this))\n    handle('windows.getAll', this.getAll.bind(this))\n    handle('windows.create', this.create.bind(this))\n    handle('windows.update', this.update.bind(this))\n    handle('windows.remove', this.remove.bind(this))\n\n    this.ctx.store.on('window-added', this.observeWindow.bind(this))\n  }\n\n  private observeWindow(window: Electron.BrowserWindow) {\n    const windowId = window.id\n\n    window.on('focus', () => {\n      this.onFocusChanged(windowId)\n    })\n\n    window.once('closed', () => {\n      this.ctx.store.windowDetailsCache.delete(windowId)\n      this.ctx.store.removeWindow(window)\n      this.onRemoved(windowId)\n    })\n\n    this.onCreated(windowId)\n\n    debug(`Observing window[${windowId}]`)\n  }\n\n  private createWindowDetails(win: BrowserWindow) {\n    const details: Partial<chrome.windows.Window> = {\n      id: win.id,\n      focused: win.isFocused(),\n      top: win.getPosition()[1],\n      left: win.getPosition()[0],\n      width: win.getSize()[0],\n      height: win.getSize()[1],\n      tabs: Array.from(this.ctx.store.tabs)\n        .filter((tab) => {\n          const ownerWindow = this.ctx.store.tabToWindow.get(tab)\n          return ownerWindow?.isDestroyed() ? false : ownerWindow?.id === win.id\n        })\n        .map((tab) => this.ctx.store.tabDetailsCache.get(tab.id) as chrome.tabs.Tab)\n        .filter(Boolean),\n      incognito: !win.webContents.session.isPersistent(),\n      type: 'normal', // TODO\n      state: getWindowState(win),\n      alwaysOnTop: win.isAlwaysOnTop(),\n      sessionId: 'default', // TODO\n    }\n\n    this.ctx.store.windowDetailsCache.set(win.id, details)\n    return details\n  }\n\n  private getWindowDetails(win: BrowserWindow) {\n    if (this.ctx.store.windowDetailsCache.has(win.id)) {\n      return this.ctx.store.windowDetailsCache.get(win.id)\n    }\n    const details = this.createWindowDetails(win)\n    return details\n  }\n\n  private getWindowFromId(id: number) {\n    if (id === WindowsAPI.WINDOW_ID_CURRENT) {\n      return this.ctx.store.getCurrentWindow()\n    } else {\n      return this.ctx.store.getWindowById(id)\n    }\n  }\n\n  private get(event: ExtensionEvent, windowId: number) {\n    const win = this.getWindowFromId(windowId)\n    if (!win) return { id: WindowsAPI.WINDOW_ID_NONE }\n    return this.getWindowDetails(win)\n  }\n\n  private getLastFocused(event: ExtensionEvent) {\n    const win = this.ctx.store.getLastFocusedWindow()\n    return win ? this.getWindowDetails(win) : null\n  }\n\n  private getAll(event: ExtensionEvent) {\n    return Array.from(this.ctx.store.windows).map(this.getWindowDetails.bind(this))\n  }\n\n  private async create(event: ExtensionEvent, details: chrome.windows.CreateData) {\n    const win = await this.ctx.store.createWindow(event, details)\n    return this.getWindowDetails(win)\n  }\n\n  private async update(\n    event: ExtensionEvent,\n    windowId: number,\n    updateProperties: chrome.windows.UpdateInfo = {}\n  ) {\n    const win = this.getWindowFromId(windowId)\n    if (!win) return\n\n    const props = updateProperties\n\n    if (props.state) {\n      switch (props.state) {\n        case 'maximized':\n          win.maximize()\n          break\n        case 'minimized':\n          win.minimize()\n          break\n        case 'normal': {\n          if (win.isMinimized() || win.isMaximized()) {\n            win.restore()\n          }\n          break\n        }\n      }\n    }\n\n    return this.createWindowDetails(win)\n  }\n\n  private async remove(event: ExtensionEvent, windowId: number = WindowsAPI.WINDOW_ID_CURRENT) {\n    const win = this.getWindowFromId(windowId)\n    if (!win) return\n    const removedWindowId = win.id\n    await this.ctx.store.removeWindow(win)\n    this.onRemoved(removedWindowId)\n  }\n\n  onCreated(windowId: number) {\n    const window = this.ctx.store.getWindowById(windowId)\n    if (!window) return\n    const windowDetails = this.getWindowDetails(window)\n    this.ctx.router.broadcastEvent('windows.onCreated', windowDetails)\n  }\n\n  onRemoved(windowId: number) {\n    this.ctx.router.broadcastEvent('windows.onRemoved', windowId)\n  }\n\n  onFocusChanged(windowId: number) {\n    if (this.ctx.store.lastFocusedWindowId === windowId) return\n\n    this.ctx.store.lastFocusedWindowId = windowId\n    this.ctx.router.broadcastEvent('windows.onFocusChanged', windowId)\n  }\n}\n","import { app, session as electronSession } from 'electron'\nimport { EventEmitter } from 'events'\nimport path from 'path'\nimport { promises as fs } from 'fs'\n\nimport { BrowserActionAPI } from './api/browser-action'\nimport { TabsAPI } from './api/tabs'\nimport { WindowsAPI } from './api/windows'\nimport { WebNavigationAPI } from './api/web-navigation'\nimport { ExtensionStore } from './store'\nimport { ContextMenusAPI } from './api/context-menus'\nimport { RuntimeAPI } from './api/runtime'\nimport { CookiesAPI } from './api/cookies'\nimport { NotificationsAPI } from './api/notifications'\nimport { ChromeExtensionImpl } from './impl'\nimport { CommandsAPI } from './api/commands'\nimport { ExtensionContext } from './context'\nimport { ExtensionRouter } from './router'\n\nexport interface ChromeExtensionOptions extends ChromeExtensionImpl {\n  session?: Electron.Session\n\n  /**\n   * Path to electron-chrome-extensions module files. Might be needed if\n   * JavaScript bundlers like Webpack are used in your build process.\n   */\n  modulePath?: string\n}\n\nconst sessionMap = new WeakMap<Electron.Session, ElectronChromeExtensions>()\n\n/**\n * Provides an implementation of various Chrome extension APIs to a session.\n */\nexport class ElectronChromeExtensions extends EventEmitter {\n  /** Retrieve an instance of this class associated with the given session. */\n  static fromSession(session: Electron.Session) {\n    return sessionMap.get(session)\n  }\n\n  private ctx: ExtensionContext\n  private modulePath: string\n\n  private api: {\n    browserAction: BrowserActionAPI\n    contextMenus: ContextMenusAPI\n    commands: CommandsAPI\n    cookies: CookiesAPI\n    notifications: NotificationsAPI\n    runtime: RuntimeAPI\n    tabs: TabsAPI\n    webNavigation: WebNavigationAPI\n    windows: WindowsAPI\n  }\n\n  constructor(opts?: ChromeExtensionOptions) {\n    super()\n\n    const { session = electronSession.defaultSession, modulePath, ...impl } = opts || {}\n\n    if (sessionMap.has(session)) {\n      throw new Error(`Extensions instance already exists for the given session`)\n    }\n\n    sessionMap.set(session, this)\n\n    const router = new ExtensionRouter(session)\n    const store = new ExtensionStore(impl)\n\n    this.ctx = {\n      emit: this.emit.bind(this),\n      router,\n      session,\n      store,\n    }\n\n    this.modulePath = modulePath || path.join(__dirname, '..')\n\n    this.api = {\n      browserAction: new BrowserActionAPI(this.ctx),\n      contextMenus: new ContextMenusAPI(this.ctx),\n      commands: new CommandsAPI(this.ctx),\n      cookies: new CookiesAPI(this.ctx),\n      notifications: new NotificationsAPI(this.ctx),\n      runtime: new RuntimeAPI(this.ctx),\n      tabs: new TabsAPI(this.ctx),\n      webNavigation: new WebNavigationAPI(this.ctx),\n      windows: new WindowsAPI(this.ctx),\n    }\n\n    this.prependPreload()\n  }\n\n  private async prependPreload() {\n    const { session } = this.ctx\n    let preloads = session.getPreloads()\n\n    const preloadPath = path.join(this.modulePath, 'dist/preload.js')\n\n    const preloadIndex = preloads.indexOf(preloadPath)\n    if (preloadIndex > -1) {\n      preloads.splice(preloadIndex, 1)\n    }\n\n    preloads = [preloadPath, ...preloads]\n    session.setPreloads(preloads)\n\n    let preloadExists = false\n    try {\n      const stat = await fs.stat(preloadPath)\n      preloadExists = stat.isFile()\n    } catch {}\n\n    if (!preloadExists) {\n      console.error(\n        `Unable to access electron-chrome-extensions preload file (${preloadPath}). Consider configuring the 'modulePath' constructor option.`\n      )\n    }\n  }\n\n  /** Add webContents to be tracked as a tab. */\n  addTab(tab: Electron.WebContents, window: Electron.BrowserWindow) {\n    this.ctx.store.addTab(tab, window)\n  }\n\n  /** Notify extension system that the active tab has changed. */\n  selectTab(tab: Electron.WebContents) {\n    if (this.ctx.store.tabs.has(tab)) {\n      this.api.tabs.onActivated(tab.id)\n    }\n  }\n\n  /**\n   * Add webContents to be tracked as an extension host which will receive\n   * extension events when a chrome-extension:// resource is loaded.\n   *\n   * This is usually reserved for extension background pages and popups, but\n   * can also be used in other special cases.\n   *\n   * @deprecated Extension hosts are now tracked lazily when they send\n   * extension IPCs to the main process.\n   */\n  addExtensionHost(host: Electron.WebContents) {\n    console.warn('ElectronChromeExtensions.addExtensionHost() is deprecated')\n  }\n\n  /**\n   * Get collection of menu items managed by the `chrome.contextMenus` API.\n   * @see https://developer.chrome.com/extensions/contextMenus\n   */\n  getContextMenuItems(webContents: Electron.WebContents, params: Electron.ContextMenuParams) {\n    return this.api.contextMenus.buildMenuItemsForParams(webContents, params)\n  }\n\n  /**\n   * Add extensions to be visible as an extension action button.\n   *\n   * @deprecated Not needed in Electron >=12.\n   */\n  addExtension(extension: Electron.Extension) {\n    console.warn('ElectronChromeExtensions.addExtension() is deprecated')\n    this.api.browserAction.processExtension(extension)\n  }\n\n  /**\n   * Remove extensions from the list of visible extension action buttons.\n   *\n   * @deprecated Not needed in Electron >=12.\n   */\n  removeExtension(extension: Electron.Extension) {\n    console.warn('ElectronChromeExtensions.removeExtension() is deprecated')\n    this.api.browserAction.removeActions(extension.id)\n  }\n}\n\n/**\n * @deprecated Use `ElectronChromeExtensions` instead.\n */\nexport const Extensions = ElectronChromeExtensions\n","import { BrowserWindow, Session } from 'electron'\n\nconst debug = require('debug')('electron-chrome-extensions:popup')\n\nexport interface PopupAnchorRect {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\ninterface PopupViewOptions {\n  extensionId: string\n  session: Session\n  parent: BrowserWindow\n  url: string\n  anchorRect: PopupAnchorRect\n}\n\nconst supportsPreferredSize = () => {\n  const major = parseInt(process.versions.electron.split('.').shift() || '', 10)\n  return major >= 12\n}\n\nexport class PopupView {\n  static POSITION_PADDING = 5\n\n  static BOUNDS = {\n    minWidth: 25,\n    minHeight: 25,\n    maxWidth: 800,\n    maxHeight: 600,\n  }\n\n  browserWindow?: BrowserWindow\n  parent?: BrowserWindow\n  extensionId: string\n\n  private anchorRect: PopupAnchorRect\n  private destroyed: boolean = false\n  private hidden: boolean = true\n\n  /** Preferred size changes are only received in Electron v12+ */\n  private usingPreferredSize = supportsPreferredSize()\n\n  private readyPromise: Promise<void>\n\n  constructor(opts: PopupViewOptions) {\n    this.parent = opts.parent\n    this.extensionId = opts.extensionId\n    this.anchorRect = opts.anchorRect\n\n    this.browserWindow = new BrowserWindow({\n      show: false,\n      frame: false,\n      parent: opts.parent,\n      movable: false,\n      maximizable: false,\n      minimizable: false,\n      resizable: false,\n      skipTaskbar: true,\n      backgroundColor: '#ffffff',\n      webPreferences: {\n        session: opts.session,\n        sandbox: true,\n        nodeIntegration: false,\n        nodeIntegrationInWorker: false,\n        contextIsolation: true,\n        enablePreferredSizeMode: true,\n      },\n    })\n\n    const untypedWebContents = this.browserWindow.webContents as any\n    untypedWebContents.on('preferred-size-changed', this.updatePreferredSize)\n\n    this.browserWindow.webContents.on('devtools-closed', this.maybeClose)\n    this.browserWindow.on('blur', this.maybeClose)\n    this.browserWindow.on('closed', this.destroy)\n    this.parent.once('closed', this.destroy)\n\n    this.readyPromise = this.load(opts.url)\n  }\n\n  private show() {\n    this.hidden = false\n    this.browserWindow?.show()\n  }\n\n  private async load(url: string): Promise<void> {\n    const win = this.browserWindow!\n\n    try {\n      await win.webContents.loadURL(url)\n    } catch (e) {\n      console.error(e)\n    }\n\n    if (this.destroyed) return\n\n    const hasChildNodes = await this.browserWindow!.webContents.executeJavaScript(\n      `((${() => {\n        return document.body.hasChildNodes();\n      }})())`\n    )\n\n    if (!hasChildNodes) {\n      this.destroy()\n      return\n    }\n\n    if (!this.usingPreferredSize) {\n      this.setSize({width: PopupView.BOUNDS.minWidth, height: PopupView.BOUNDS.minHeight});\n\n      // Wait for content and layout to load\n      // Ideally we would wait for DOM to finish loading instead of a timeout which doesn't work reliably\n      // E.g.: grammarly depending on machine speed will not show up correctly, and will be locked at a smaller size cutting off content.\n      await new Promise((resolve) => setTimeout(resolve, 200))\n      if (this.destroyed) return\n\n      await this.queryPreferredSize()\n      if (this.destroyed) return\n\n      this.show()\n    }\n  }\n\n  destroy = () => {\n    if (this.destroyed) return\n\n    this.destroyed = true\n\n    debug(`destroying ${this.extensionId}`)\n\n    if (this.parent) {\n      if (!this.parent.isDestroyed()) {\n        this.parent.off('closed', this.destroy)\n      }\n      this.parent = undefined\n    }\n\n    if (this.browserWindow) {\n      if (!this.browserWindow.isDestroyed()) {\n        const { webContents } = this.browserWindow\n\n        if (!webContents.isDestroyed() && webContents.isDevToolsOpened()) {\n          webContents.closeDevTools()\n        }\n\n        this.browserWindow.off('closed', this.destroy)\n        this.browserWindow.destroy()\n      }\n\n      this.browserWindow = undefined\n    }\n  }\n\n  isDestroyed() {\n    return this.destroyed\n  }\n\n  /** Resolves when the popup finishes loading. */\n  whenReady() {\n    return this.readyPromise\n  }\n\n  setSize(rect: Partial<Electron.Rectangle>) {\n    if (!this.browserWindow || !this.parent) return\n\n    const width = Math.floor(\n      Math.min(PopupView.BOUNDS.maxWidth, Math.max(rect.width || 0, PopupView.BOUNDS.minWidth))\n    )\n\n    const height = Math.floor(\n      Math.min(PopupView.BOUNDS.maxHeight, Math.max(rect.height || 0, PopupView.BOUNDS.minHeight))\n    )\n\n    debug(`setSize`, { width, height })\n\n    this.browserWindow?.setBounds({\n      ...this.browserWindow.getBounds(),\n      width,\n      height,\n    })\n  }\n\n  private maybeClose = () => {\n    // Keep open if webContents is being inspected\n    if (!this.browserWindow?.isDestroyed() && this.browserWindow?.webContents.isDevToolsOpened()) {\n      debug('preventing close due to DevTools being open')\n      return\n    }\n\n    // For extension popups with a login form, the user may need to access a\n    // program outside of the app. Closing the popup would then add\n    // inconvenience.\n    if (!BrowserWindow.getFocusedWindow()) {\n      debug('preventing close due to focus residing outside of the app')\n      return\n    }\n\n    this.destroy()\n  }\n\n  private updatePosition() {\n    if (!this.browserWindow || !this.parent) return\n\n    const winBounds = this.parent.getBounds()\n    const viewBounds = this.browserWindow.getBounds()\n\n    // TODO: support more orientations than just top-right\n    let x = winBounds.x + this.anchorRect.x + this.anchorRect.width - viewBounds.width\n    let y = winBounds.y + this.anchorRect.y + this.anchorRect.height + PopupView.POSITION_PADDING\n\n    // Convert to ints\n    x = Math.floor(x)\n    y = Math.floor(y)\n\n    debug(`updatePosition`, { x, y })\n\n    this.browserWindow.setBounds({\n      ...this.browserWindow.getBounds(),\n      x,\n      y,\n    })\n  }\n\n  /** Backwards compat for Electron <12 */\n  private async queryPreferredSize() {\n    if (this.usingPreferredSize || this.destroyed) return\n\n    const rect = await this.browserWindow!.webContents.executeJavaScript(\n      `((${() => {\n\n        // rect here will not always reflect truely what the content is, and sometimes\n        // reflects what the size of the client window was instead\n        // prior to this call, we'll set our window width/height to the minimum and if our bounding rect here is unchanged from that\n        // we will manually calculate children to get a more accurate width or height\n        let rect = document.body.getBoundingClientRect()\n        var children = document.body.children\n\n        const defaultMinWidth = 25;\n        const defaultMinHeight = 25;\n\n        if (rect.width == defaultMinWidth) {\n          rect.width = 0;\n          for (var i = 0; i < children.length; i++) {\n            //@ts-ignore\n            rect.width += children[i].offsetWidth;\n          }\n        }\n\n        if (rect.height == defaultMinHeight) {\n          rect.height = 0;\n          for (var i = 0; i < children.length; i++) {\n            //@ts-ignore\n            rect.height += children[i].offsetHeight;\n          }\n        }\n\n        return { width: rect.width, height: rect.height }\n      }})())`\n    )\n\n    if (this.destroyed) return\n\n    this.setSize({ width: rect.width, height: rect.height })\n    this.updatePosition()\n  }\n\n  private updatePreferredSize = (event: Electron.Event, size: Electron.Size) => {\n    debug('updatePreferredSize', size)\n    this.usingPreferredSize = true\n    this.setSize(size)\n    this.updatePosition()\n\n    // Wait to reveal popup until it's sized and positioned correctly\n    if (this.hidden) this.show()\n  }\n}\n","import { app, Extension, ipcMain, session, Session, WebContents } from 'electron'\n\nconst createDebug = require('debug')\n\n// Shorten base64 encoded icons\nconst shortenValues = (k: string, v: any) =>\n  typeof v === 'string' && v.length > 128 ? v.substr(0, 128) + '...' : v\n\ncreateDebug.formatters.r = (value: any) => {\n  return value ? JSON.stringify(value, shortenValues, '  ') : value\n}\n\nconst debug = createDebug('electron-chrome-extensions:router')\n\nconst DEFAULT_SESSION = '_self'\n\ninterface RoutingDelegateObserver {\n  session: Electron.Session\n  onExtensionMessage(\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string | undefined,\n    handlerName: string,\n    ...args: any[]\n  ): Promise<void>\n  addListener(listener: EventListener, extensionId: string, eventName: string): void\n  removeListener(listener: EventListener, extensionId: string, eventName: string): void\n}\n\nlet gRoutingDelegate: RoutingDelegate\n\n/**\n * Handles event routing IPCs and delivers them to the observer with the\n * associated session.\n */\nclass RoutingDelegate {\n  static get() {\n    return gRoutingDelegate || (gRoutingDelegate = new RoutingDelegate())\n  }\n\n  private sessionMap: WeakMap<Session, RoutingDelegateObserver> = new WeakMap()\n\n  private constructor() {\n    ipcMain.handle('crx-msg', this.onRouterMessage)\n    ipcMain.handle('crx-msg-remote', this.onRemoteMessage)\n    ipcMain.on('crx-add-listener', this.onAddListener)\n    ipcMain.on('crx-remove-listener', this.onRemoveListener)\n  }\n\n  addObserver(observer: RoutingDelegateObserver) {\n    this.sessionMap.set(observer.session, observer)\n  }\n\n  private onRouterMessage = async (\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string,\n    handlerName: string,\n    ...args: any[]\n  ) => {\n    debug(`received '${handlerName}'`, args)\n\n    const observer = this.sessionMap.get(event.sender.session)\n\n    return observer?.onExtensionMessage(event, extensionId, handlerName, ...args)\n  }\n\n  private onRemoteMessage = async (\n    event: Electron.IpcMainInvokeEvent,\n    sessionPartition: string,\n    handlerName: string,\n    ...args: any[]\n  ) => {\n    debug(`received remote '${handlerName}' for '${sessionPartition}'`, args)\n\n    const ses =\n      sessionPartition === DEFAULT_SESSION\n        ? event.sender.session\n        : session.fromPartition(sessionPartition)\n\n    const observer = this.sessionMap.get(ses)\n\n    return observer?.onExtensionMessage(event, undefined, handlerName, ...args)\n  }\n\n  private onAddListener = (\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string,\n    eventName: string\n  ) => {\n    const observer = this.sessionMap.get(event.sender.session)\n    const listener: EventListener = { host: event.sender, extensionId }\n    return observer?.addListener(listener, extensionId, eventName)\n  }\n\n  private onRemoveListener = (\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string,\n    eventName: string\n  ) => {\n    const observer = this.sessionMap.get(event.sender.session)\n    const listener: EventListener = { host: event.sender, extensionId }\n    return observer?.removeListener(listener, extensionId, eventName)\n  }\n}\n\nexport interface ExtensionEvent {\n  sender: WebContents\n  extension: Extension\n}\n\nexport type HandlerCallback = (event: ExtensionEvent, ...args: any[]) => any\n\nexport interface HandlerOptions {\n  /** Whether the handler can be invoked on behalf of a different session. */\n  allowRemote?: boolean\n  /** Whether an extension context is required to invoke the handler. */\n  extensionContext: boolean\n}\n\ninterface Handler extends HandlerOptions {\n  callback: HandlerCallback\n}\n\n/** e.g. 'tabs.query' */\ntype EventName = string\n\ntype HandlerMap = Map<EventName, Handler>\n\ninterface EventListener {\n  host: Electron.WebContents\n  extensionId: string\n}\n\nconst eventListenerEquals = (eventListener: EventListener) => (other: EventListener) =>\n  other.host === eventListener.host && other.extensionId === eventListener.extensionId\n\nexport class ExtensionRouter {\n  private handlers: HandlerMap = new Map()\n  private listeners: Map<EventName, EventListener[]> = new Map()\n\n  /**\n   * Collection of all extension hosts in the session.\n   *\n   * Currently the router has no ability to wake up non-persistent background\n   * scripts to deliver events. For now we just hold a reference to them to\n   * prevent them from being terminated.\n   */\n  private extensionHosts: Set<Electron.WebContents> = new Set()\n\n  constructor(\n    public session: Electron.Session,\n    private delegate: RoutingDelegate = RoutingDelegate.get()\n  ) {\n    this.delegate.addObserver(this)\n\n    session.on('extension-unloaded', (event, extension) => {\n      this.filterListeners((listener) => listener.extensionId !== extension.id)\n    })\n\n    app.on('web-contents-created', (event, webContents) => {\n      if (webContents.session === this.session && webContents.getType() === 'backgroundPage') {\n        debug(`storing reference to background host [url:'${webContents.getURL()}']`)\n        this.extensionHosts.add(webContents)\n      }\n    })\n  }\n\n  private filterListeners(predicate: (listener: EventListener) => boolean) {\n    for (const [eventName, listeners] of this.listeners) {\n      const filteredListeners = listeners.filter(predicate)\n      const delta = listeners.length - filteredListeners.length\n\n      if (filteredListeners.length > 0) {\n        this.listeners.set(eventName, filteredListeners)\n      } else {\n        this.listeners.delete(eventName)\n      }\n\n      if (delta > 0) {\n        debug(`removed ${delta} listener(s) for '${eventName}'`)\n      }\n    }\n  }\n\n  private observeListenerHost(host: Electron.WebContents) {\n    debug(`observing listener [id:${host.id}, url:'${host.getURL()}']`)\n    host.once('destroyed', () => {\n      debug(`extension host destroyed [id:${host.id}]`)\n      this.filterListeners((listener) => listener.host !== host)\n    })\n  }\n\n  addListener(listener: EventListener, extensionId: string, eventName: string) {\n    const { listeners, session } = this\n\n    const extension = session.getExtension(extensionId)\n    if (!extension) {\n      throw new Error(`extension not registered in session [extensionId:${extensionId}]`)\n    }\n\n    if (!listeners.has(eventName)) {\n      listeners.set(eventName, [])\n    }\n\n    const eventListeners = listeners.get(eventName)!\n    const existingEventListener = eventListeners.find(eventListenerEquals(listener))\n\n    if (existingEventListener) {\n      debug(`ignoring existing '${eventName}' event listener for ${extensionId}`)\n    } else {\n      debug(`adding '${eventName}' event listener for ${extensionId}`)\n      eventListeners.push(listener)\n      this.observeListenerHost(listener.host)\n    }\n  }\n\n  removeListener(listener: EventListener, extensionId: string, eventName: string) {\n    const { listeners } = this\n\n    const eventListeners = listeners.get(eventName)\n    if (!eventListeners) {\n      console.error(`event listener not registered for '${eventName}'`)\n      return\n    }\n\n    const index = eventListeners.findIndex(eventListenerEquals(listener))\n\n    if (index >= 0) {\n      debug(`removing '${eventName}' event listener for ${extensionId}`)\n      eventListeners.splice(index, 1)\n    }\n\n    if (eventListeners.length === 0) {\n      listeners.delete(eventName)\n    }\n  }\n\n  private getHandler(handlerName: string) {\n    const handler = this.handlers.get(handlerName)\n    if (!handler) {\n      throw new Error(`${handlerName} is not a registered handler`)\n    }\n\n    return handler\n  }\n\n  async onExtensionMessage(\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string | undefined,\n    handlerName: string,\n    ...args: any[]\n  ) {\n    const { session } = this\n    const { sender } = event\n    const handler = this.getHandler(handlerName)\n\n    if (sender.session !== session && !handler.allowRemote) {\n      throw new Error(`${handlerName} does not support calling from a remote session`)\n    }\n\n    const extension = extensionId ? sender.session.getExtension(extensionId) : undefined\n    if (!extension && handler.extensionContext) {\n      throw new Error(`${handlerName} was sent from an unknown extension context`)\n    }\n\n    const extEvent = {\n      sender,\n      extension: extension!,\n    }\n\n    const result = await handler.callback(extEvent, ...args)\n\n    debug(`${handlerName} result: %r`, result)\n\n    return result\n  }\n\n  private handle(name: string, callback: HandlerCallback, opts?: HandlerOptions): void {\n    this.handlers.set(name, {\n      callback,\n      extensionContext: typeof opts?.extensionContext === 'boolean' ? opts.extensionContext : true,\n      allowRemote: typeof opts?.allowRemote === 'boolean' ? opts.allowRemote : false,\n    })\n  }\n\n  /** Returns a callback to register API handlers for the given context. */\n  apiHandler() {\n    return (name: string, callback: HandlerCallback, opts?: HandlerOptions) => {\n      this.handle(name, callback, opts)\n    }\n  }\n\n  /**\n   * Sends extension event to the host for the given extension ID if it\n   * registered a listener for it.\n   */\n  sendEvent(extensionId: string | undefined, eventName: string, ...args: any[]) {\n    const { listeners } = this\n\n    let eventListeners = listeners.get(eventName)\n\n    if (extensionId) {\n      // TODO: extension permissions check\n\n      eventListeners = eventListeners?.filter((el) => el.extensionId === extensionId)\n    }\n\n    if (!eventListeners || eventListeners.length === 0) {\n      debug(`ignoring '${eventName}' event with no listeners`)\n      return\n    }\n\n    for (const { host } of eventListeners) {\n      // TODO: may need to wake lazy extension context\n      if (host.isDestroyed()) {\n        console.error(`Unable to send '${eventName}' to extension host for ${extensionId}`)\n        continue\n      }\n\n      const ipcName = `crx-${eventName}`\n      host.send(ipcName, ...args)\n    }\n  }\n\n  /** Broadcasts extension event to all extension hosts listening for it. */\n  broadcastEvent(eventName: string, ...args: any[]) {\n    this.sendEvent(undefined, eventName, ...args)\n  }\n}\n","import { BrowserWindow, webContents } from 'electron'\nimport { EventEmitter } from 'events'\nimport { ContextMenuType } from './api/common'\nimport { ChromeExtensionImpl } from './impl'\nimport { ExtensionEvent } from './router'\n\nconst debug = require('debug')('electron-chrome-extensions:store')\n\nexport class ExtensionStore extends EventEmitter {\n  /** Tabs observed by the extensions system. */\n  tabs = new Set<Electron.WebContents>()\n\n  /** Windows observed by the extensions system. */\n  windows = new Set<Electron.BrowserWindow>()\n\n  lastFocusedWindowId?: number\n\n  /**\n   * Map of tabs to their parent window.\n   *\n   * It's not possible to access the parent of a BrowserView so we must manage\n   * this ourselves.\n   */\n  tabToWindow = new WeakMap<Electron.WebContents, Electron.BrowserWindow>()\n\n  /** Map of windows to their active tab. */\n  private windowToActiveTab = new WeakMap<Electron.BrowserWindow, Electron.WebContents>()\n\n  tabDetailsCache = new Map<number, Partial<chrome.tabs.Tab>>()\n  windowDetailsCache = new Map<number, Partial<chrome.windows.Window>>()\n\n  constructor(public impl: ChromeExtensionImpl) {\n    super()\n  }\n\n  getWindowById(windowId: number) {\n    return Array.from(this.windows).find(\n      (window) => !window.isDestroyed() && window.id === windowId\n    )\n  }\n\n  getLastFocusedWindow() {\n    return this.lastFocusedWindowId ? this.getWindowById(this.lastFocusedWindowId) : null\n  }\n\n  getCurrentWindow() {\n    return this.getLastFocusedWindow()\n  }\n\n  addWindow(window: Electron.BrowserWindow) {\n    if (this.windows.has(window)) return\n\n    this.windows.add(window)\n\n    if (typeof this.lastFocusedWindowId !== 'number') {\n      this.lastFocusedWindowId = window.id\n    }\n\n    this.emit('window-added', window)\n  }\n\n  async createWindow(event: ExtensionEvent, details: chrome.windows.CreateData) {\n    if (typeof this.impl.createWindow !== 'function') {\n      throw new Error('createWindow is not implemented')\n    }\n\n    const win = await this.impl.createWindow(details)\n\n    this.addWindow(win)\n\n    return win\n  }\n\n  async removeWindow(window: Electron.BrowserWindow) {\n    if (!this.windows.has(window)) return\n\n    this.windows.delete(window)\n\n    if (typeof this.impl.removeWindow === 'function') {\n      await this.impl.removeWindow(window)\n    } else {\n      window.destroy()\n    }\n  }\n\n  getTabById(tabId: number) {\n    return Array.from(this.tabs).find((tab) => !tab.isDestroyed() && tab.id === tabId)\n  }\n\n  addTab(tab: Electron.WebContents, window: Electron.BrowserWindow) {\n    if (this.tabs.has(tab)) return\n\n    this.tabs.add(tab)\n    this.tabToWindow.set(tab, window)\n    this.addWindow(window)\n\n    const activeTab = this.getActiveTabFromWebContents(tab)\n    if (!activeTab) {\n      this.setActiveTab(tab)\n    }\n\n    this.emit('tab-added', tab)\n  }\n\n  removeTab(tab: Electron.WebContents) {\n    if (!this.tabs.has(tab)) return\n\n    const tabId = tab.id\n    const win = this.tabToWindow.get(tab)!\n\n    this.tabs.delete(tab)\n    this.tabToWindow.delete(tab)\n\n    // TODO: clear active tab\n\n    // Clear window if it has no remaining tabs\n    const windowHasTabs = Array.from(this.tabs).find((tab) => this.tabToWindow.get(tab) === win)\n    if (!windowHasTabs) {\n      this.windows.delete(win)\n    }\n\n    if (typeof this.impl.removeTab === 'function') {\n      this.impl.removeTab(tab, win)\n    }\n\n    this.emit('tab-removed', tabId)\n  }\n\n  async createTab(details: chrome.tabs.CreateProperties) {\n    if (typeof this.impl.createTab !== 'function') {\n      throw new Error('createTab is not implemented')\n    }\n\n    // Fallback to current window\n    if (!details.windowId) {\n      details.windowId = this.lastFocusedWindowId\n    }\n\n    const result = await this.impl.createTab(details)\n\n    if (!Array.isArray(result)) {\n      throw new Error('createTab must return an array of [tab, window]')\n    }\n\n    const [tab, window] = result\n\n    if (typeof tab !== 'object' || !webContents.fromId(tab.id)) {\n      throw new Error('createTab must return a WebContents')\n    } else if (typeof window !== 'object') {\n      throw new Error('createTab must return a BrowserWindow')\n    }\n\n    this.addTab(tab, window)\n\n    return tab\n  }\n\n  getActiveTabFromWindow(win: Electron.BrowserWindow) {\n    const activeTab = win && !win.isDestroyed() && this.windowToActiveTab.get(win)\n    return (activeTab && !activeTab.isDestroyed() && activeTab) || undefined\n  }\n\n  getActiveTabFromWebContents(wc: Electron.WebContents): Electron.WebContents | undefined {\n    const win = this.tabToWindow.get(wc) || BrowserWindow.fromWebContents(wc)\n    const activeTab = win ? this.getActiveTabFromWindow(win) : undefined\n    return activeTab\n  }\n\n  getActiveTabOfCurrentWindow() {\n    const win = this.getCurrentWindow()\n    return win ? this.getActiveTabFromWindow(win) : undefined\n  }\n\n  setActiveTab(tab: Electron.WebContents) {\n    const win = this.tabToWindow.get(tab)\n    if (!win) {\n      throw new Error('Active tab has no parent window')\n    }\n\n    const prevActiveTab = this.getActiveTabFromWebContents(tab)\n\n    this.windowToActiveTab.set(win, tab)\n\n    if (tab.id !== prevActiveTab?.id) {\n      this.emit('active-tab-changed', tab, win)\n\n      if (typeof this.impl.selectTab === 'function') {\n        this.impl.selectTab(tab, win)\n      }\n    }\n  }\n\n  buildMenuItems(extensionId: string, menuType: ContextMenuType): Electron.MenuItem[] {\n    // This function is overwritten by ContextMenusAPI\n    return []\n  }\n}\n","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug');\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => enableOverride === null ? createDebug.enabled(namespace) : enableOverride,\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tlet i;\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tconst len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) {\n\t\t\t\t// ignore empty strings\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names.map(toNamespace),\n\t\t\t...createDebug.skips.map(toNamespace).map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tif (name[name.length - 1] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet i;\n\t\tlet len;\n\n\t\tfor (i = 0, len = createDebug.skips.length; i < len; i++) {\n\t\t\tif (createDebug.skips[i].test(name)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = createDebug.names.length; i < len; i++) {\n\t\t\tif (createDebug.names[i].test(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\n\tfunction toNamespace(regexp) {\n\t\treturn regexp.toString()\n\t\t\t.substring(2, regexp.toString().length - 2)\n\t\t\t.replace(/\\.\\*\\?$/, '*');\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","/**\n * Detect Electron renderer / nwjs process, which is node, but we should\n * treat as a browser.\n */\n\nif (typeof process === 'undefined' || process.type === 'renderer' || process.browser === true || process.__nwjs) {\n\tmodule.exports = require('./browser.js');\n} else {\n\tmodule.exports = require('./node.js');\n}\n","/**\n * Module dependencies.\n */\n\nconst tty = require('tty');\nconst util = require('util');\n\n/**\n * This is the Node.js implementation of `debug()`.\n */\n\nexports.init = init;\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.destroy = util.deprecate(\n\t() => {},\n\t'Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.'\n);\n\n/**\n * Colors.\n */\n\nexports.colors = [6, 2, 3, 4, 5, 1];\n\ntry {\n\t// Optional dependency (as in, doesn't need to be installed, NOT like optionalDependencies in package.json)\n\t// eslint-disable-next-line import/no-extraneous-dependencies\n\tconst supportsColor = require('supports-color');\n\n\tif (supportsColor && (supportsColor.stderr || supportsColor).level >= 2) {\n\t\texports.colors = [\n\t\t\t20,\n\t\t\t21,\n\t\t\t26,\n\t\t\t27,\n\t\t\t32,\n\t\t\t33,\n\t\t\t38,\n\t\t\t39,\n\t\t\t40,\n\t\t\t41,\n\t\t\t42,\n\t\t\t43,\n\t\t\t44,\n\t\t\t45,\n\t\t\t56,\n\t\t\t57,\n\t\t\t62,\n\t\t\t63,\n\t\t\t68,\n\t\t\t69,\n\t\t\t74,\n\t\t\t75,\n\t\t\t76,\n\t\t\t77,\n\t\t\t78,\n\t\t\t79,\n\t\t\t80,\n\t\t\t81,\n\t\t\t92,\n\t\t\t93,\n\t\t\t98,\n\t\t\t99,\n\t\t\t112,\n\t\t\t113,\n\t\t\t128,\n\t\t\t129,\n\t\t\t134,\n\t\t\t135,\n\t\t\t148,\n\t\t\t149,\n\t\t\t160,\n\t\t\t161,\n\t\t\t162,\n\t\t\t163,\n\t\t\t164,\n\t\t\t165,\n\t\t\t166,\n\t\t\t167,\n\t\t\t168,\n\t\t\t169,\n\t\t\t170,\n\t\t\t171,\n\t\t\t172,\n\t\t\t173,\n\t\t\t178,\n\t\t\t179,\n\t\t\t184,\n\t\t\t185,\n\t\t\t196,\n\t\t\t197,\n\t\t\t198,\n\t\t\t199,\n\t\t\t200,\n\t\t\t201,\n\t\t\t202,\n\t\t\t203,\n\t\t\t204,\n\t\t\t205,\n\t\t\t206,\n\t\t\t207,\n\t\t\t208,\n\t\t\t209,\n\t\t\t214,\n\t\t\t215,\n\t\t\t220,\n\t\t\t221\n\t\t];\n\t}\n} catch (error) {\n\t// Swallow - we only care if `supports-color` is available; it doesn't have to be.\n}\n\n/**\n * Build up the default `inspectOpts` object from the environment variables.\n *\n *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js\n */\n\nexports.inspectOpts = Object.keys(process.env).filter(key => {\n\treturn /^debug_/i.test(key);\n}).reduce((obj, key) => {\n\t// Camel-case\n\tconst prop = key\n\t\t.substring(6)\n\t\t.toLowerCase()\n\t\t.replace(/_([a-z])/g, (_, k) => {\n\t\t\treturn k.toUpperCase();\n\t\t});\n\n\t// Coerce string value into JS value\n\tlet val = process.env[key];\n\tif (/^(yes|on|true|enabled)$/i.test(val)) {\n\t\tval = true;\n\t} else if (/^(no|off|false|disabled)$/i.test(val)) {\n\t\tval = false;\n\t} else if (val === 'null') {\n\t\tval = null;\n\t} else {\n\t\tval = Number(val);\n\t}\n\n\tobj[prop] = val;\n\treturn obj;\n}, {});\n\n/**\n * Is stdout a TTY? Colored output is enabled when `true`.\n */\n\nfunction useColors() {\n\treturn 'colors' in exports.inspectOpts ?\n\t\tBoolean(exports.inspectOpts.colors) :\n\t\ttty.isatty(process.stderr.fd);\n}\n\n/**\n * Adds ANSI color escape codes if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\tconst {namespace: name, useColors} = this;\n\n\tif (useColors) {\n\t\tconst c = this.color;\n\t\tconst colorCode = '\\u001B[3' + (c < 8 ? c : '8;5;' + c);\n\t\tconst prefix = `  ${colorCode};1m${name} \\u001B[0m`;\n\n\t\targs[0] = prefix + args[0].split('\\n').join('\\n' + prefix);\n\t\targs.push(colorCode + 'm+' + module.exports.humanize(this.diff) + '\\u001B[0m');\n\t} else {\n\t\targs[0] = getDate() + name + ' ' + args[0];\n\t}\n}\n\nfunction getDate() {\n\tif (exports.inspectOpts.hideDate) {\n\t\treturn '';\n\t}\n\treturn new Date().toISOString() + ' ';\n}\n\n/**\n * Invokes `util.format()` with the specified arguments and writes to stderr.\n */\n\nfunction log(...args) {\n\treturn process.stderr.write(util.format(...args) + '\\n');\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\tif (namespaces) {\n\t\tprocess.env.DEBUG = namespaces;\n\t} else {\n\t\t// If you set a process.env field to null or undefined, it gets cast to the\n\t\t// string 'null' or 'undefined'. Just delete instead.\n\t\tdelete process.env.DEBUG;\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n\treturn process.env.DEBUG;\n}\n\n/**\n * Init logic for `debug` instances.\n *\n * Create a new `inspectOpts` object in case `useColors` is set\n * differently for a particular `debug` instance.\n */\n\nfunction init(debug) {\n\tdebug.inspectOpts = {};\n\n\tconst keys = Object.keys(exports.inspectOpts);\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tdebug.inspectOpts[keys[i]] = exports.inspectOpts[keys[i]];\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %o to `util.inspect()`, all on a single line.\n */\n\nformatters.o = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts)\n\t\t.split('\\n')\n\t\t.map(str => str.trim())\n\t\t.join(' ');\n};\n\n/**\n * Map %O to `util.inspect()`, allowing multiple lines if needed.\n */\n\nformatters.O = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts);\n};\n","'use strict';\n\nmodule.exports = (flag, argv = process.argv) => {\n\tconst prefix = flag.startsWith('-') ? '' : (flag.length === 1 ? '-' : '--');\n\tconst position = argv.indexOf(prefix + flag);\n\tconst terminatorPosition = argv.indexOf('--');\n\treturn position !== -1 && (terminatorPosition === -1 || position < terminatorPosition);\n};\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","'use strict';\nconst os = require('os');\nconst tty = require('tty');\nconst hasFlag = require('has-flag');\n\nconst {env} = process;\n\nlet flagForceColor;\nif (hasFlag('no-color') ||\n\thasFlag('no-colors') ||\n\thasFlag('color=false') ||\n\thasFlag('color=never')) {\n\tflagForceColor = 0;\n} else if (hasFlag('color') ||\n\thasFlag('colors') ||\n\thasFlag('color=true') ||\n\thasFlag('color=always')) {\n\tflagForceColor = 1;\n}\n\nfunction envForceColor() {\n\tif ('FORCE_COLOR' in env) {\n\t\tif (env.FORCE_COLOR === 'true') {\n\t\t\treturn 1;\n\t\t}\n\n\t\tif (env.FORCE_COLOR === 'false') {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn env.FORCE_COLOR.length === 0 ? 1 : Math.min(Number.parseInt(env.FORCE_COLOR, 10), 3);\n\t}\n}\n\nfunction translateLevel(level) {\n\tif (level === 0) {\n\t\treturn false;\n\t}\n\n\treturn {\n\t\tlevel,\n\t\thasBasic: true,\n\t\thas256: level >= 2,\n\t\thas16m: level >= 3\n\t};\n}\n\nfunction supportsColor(haveStream, {streamIsTTY, sniffFlags = true} = {}) {\n\tconst noFlagForceColor = envForceColor();\n\tif (noFlagForceColor !== undefined) {\n\t\tflagForceColor = noFlagForceColor;\n\t}\n\n\tconst forceColor = sniffFlags ? flagForceColor : noFlagForceColor;\n\n\tif (forceColor === 0) {\n\t\treturn 0;\n\t}\n\n\tif (sniffFlags) {\n\t\tif (hasFlag('color=16m') ||\n\t\t\thasFlag('color=full') ||\n\t\t\thasFlag('color=truecolor')) {\n\t\t\treturn 3;\n\t\t}\n\n\t\tif (hasFlag('color=256')) {\n\t\t\treturn 2;\n\t\t}\n\t}\n\n\tif (haveStream && !streamIsTTY && forceColor === undefined) {\n\t\treturn 0;\n\t}\n\n\tconst min = forceColor || 0;\n\n\tif (env.TERM === 'dumb') {\n\t\treturn min;\n\t}\n\n\tif (process.platform === 'win32') {\n\t\t// Windows 10 build 10586 is the first Windows release that supports 256 colors.\n\t\t// Windows 10 build 14931 is the first release that supports 16m/TrueColor.\n\t\tconst osRelease = os.release().split('.');\n\t\tif (\n\t\t\tNumber(osRelease[0]) >= 10 &&\n\t\t\tNumber(osRelease[2]) >= 10586\n\t\t) {\n\t\t\treturn Number(osRelease[2]) >= 14931 ? 3 : 2;\n\t\t}\n\n\t\treturn 1;\n\t}\n\n\tif ('CI' in env) {\n\t\tif (['TRAVIS', 'CIRCLECI', 'APPVEYOR', 'GITLAB_CI', 'GITHUB_ACTIONS', 'BUILDKITE', 'DRONE'].some(sign => sign in env) || env.CI_NAME === 'codeship') {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn min;\n\t}\n\n\tif ('TEAMCITY_VERSION' in env) {\n\t\treturn /^(9\\.(0*[1-9]\\d*)\\.|\\d{2,}\\.)/.test(env.TEAMCITY_VERSION) ? 1 : 0;\n\t}\n\n\tif (env.COLORTERM === 'truecolor') {\n\t\treturn 3;\n\t}\n\n\tif ('TERM_PROGRAM' in env) {\n\t\tconst version = Number.parseInt((env.TERM_PROGRAM_VERSION || '').split('.')[0], 10);\n\n\t\tswitch (env.TERM_PROGRAM) {\n\t\t\tcase 'iTerm.app':\n\t\t\t\treturn version >= 3 ? 3 : 2;\n\t\t\tcase 'Apple_Terminal':\n\t\t\t\treturn 2;\n\t\t\t// No default\n\t\t}\n\t}\n\n\tif (/-256(color)?$/i.test(env.TERM)) {\n\t\treturn 2;\n\t}\n\n\tif (/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(env.TERM)) {\n\t\treturn 1;\n\t}\n\n\tif ('COLORTERM' in env) {\n\t\treturn 1;\n\t}\n\n\treturn min;\n}\n\nfunction getSupportLevel(stream, options = {}) {\n\tconst level = supportsColor(stream, {\n\t\tstreamIsTTY: stream && stream.isTTY,\n\t\t...options\n\t});\n\n\treturn translateLevel(level);\n}\n\nmodule.exports = {\n\tsupportsColor: getSupportLevel,\n\tstdout: getSupportLevel({isTTY: tty.isatty(1)}),\n\tstderr: getSupportLevel({isTTY: tty.isatty(2)})\n};\n","module.exports = require(\"electron\");","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"os\");","module.exports = require(\"path\");","module.exports = require(\"tty\");","module.exports = require(\"util\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './browser'\n"],"names":["Menu","MenuItem","protocol","nativeImage","app","PopupView","getExtensionUrl","getExtensionManifest","getIconPath","resolveExtensionPath","matchSize","ResizeType","debug","require","isReady","registerSchemesAsPrivileged","scheme","privileges","bypassCSP","getBrowserActionDefaults","extension","manifest","action","browser_action","manifestAction","extensionAction","title","default_title","name","iconPath","icon","path","default_popup","popup","BrowserActionAPI","constructor","ctx","actionMap","Map","observers","Set","queuedUpdate","handleCrxRequest","request","callback","url","response","URL","hostname","requestType","tabId","searchParams","get","fragments","pathname","split","extensionId","imageSize","parseInt","resizeType","Up","session","getExtension","iconDetails","tabs","iconImage","iconAbsPath","createFromPath","imagePath","imageData","createFromDataURL","undefined","statusCode","mimeType","data","toPNG","e","console","error","handle","router","apiHandler","getter","propName","details","getAction","id","result","setDetails","value","defaults","valueObj","tabAction","Object","assign","onUpdate","setter","event","handleProp","prop","key","iconModified","Date","now","preloadOpts","allowRemote","extensionContext","getState","bind","activate","sender","webContents","add","once","delete","store","on","actionDetails","setupSession","processExtension","removeActions","registerBufferProtocol","set","has","getPopupUrl","popupPath","href","defaultAction","actions","Array","from","entries","map","rest","tabsInfo","keys","activeTab","getActiveTabOfCurrentWindow","activeTabId","eventType","activateClick","activateContextMenu","anchorRect","toggleExtension","isDestroyed","destroy","tab","getTabById","Error","popupUrl","win","tabToWindow","parent","emit","tabDetails","tabDetailsCache","sendEvent","menu","append","opts","appendSeparator","type","label","click","homePageUrl","homepage_url","createTab","contextMenuItems","buildMenuItems","length","forEach","item","optionsPage","options_page","options_ui","page","optionsPageUrl","enabled","process","env","NODE_ENV","DEBUG","removeExtension","x","Math","floor","y","height","queueMicrotask","size","observer","send","CommandsAPI","getAll","promises","fs","uri","resPath","join","startsWith","validateExtensionResource","stat","imageSet","match","first","pop","iconSize","icons","default_icon","getIconImage","iconAbsolutePath","escapePattern","pattern","replace","matchesPattern","regexp","RegExp","matchesTitlePattern","DEFAULT_CONTEXTS","getContextTypesFromParams","params","contexts","mediaType","pageURL","linkURL","frameURL","selectionText","isEditable","formatTitle","includes","matchesConditions","props","conditions","visible","contextTypes","targetUrl","documentUrl","inContext","some","context","targetUrlPatterns","documentUrlPatterns","ContextMenusAPI","menus","buildMenuItem","showIcon","resize","width","menuItemOptions","onClicked","buildMenuItemsFromTemplate","menuItemTemplates","itemMap","menuItem","parentId","parentMenuItem","submenu","push","menuItems","buildFromTemplate","isArray","create","createProperties","addContextItem","remove","menuItemId","items","removeAll","buildMenuItemsForExtension","contextItems","buildMenuItemsForParams","srcURL","propItems","extensionMenuItemOptions","topLevelItems","filter","opt","groupId","groupMenuItemOptions","children","menuType","extensionItems","checked","frameId","frameUrl","editable","wasChecked","pageUrl","linkUrl","parentMenuItemId","srcUrl","CookieStoreID","onChangedCauseTranslation","createCookieDetails","cookie","domain","hostOnly","Boolean","httpOnly","secure","storeId","Default","CookiesAPI","cookies","onChanged","cause","removed","changeInfo","broadcastEvent","getAllCookieStores","addListener","tabIds","Notification","TemplateType","getBody","Basic","List","message","getUrgency","priority","createScopedIdentifier","stripScopeFromIdentifier","index","indexOf","substr","NotificationsAPI","registry","clear","notificationId","close","arg1","arg2","iconUrl","notification","subtitle","body","silent","urgency","timeoutType","requireInteraction","byUser","show","getPermissionLevel","isSupported","update","EventEmitter","RuntimeAPI","openOptionsPage","active","BrowserWindow","WindowsAPI","validateExtensionUrl","TabsAPI","getAllInWindow","getCurrent","insertCSS","query","reload","goForward","goBack","observeTab","updateEvents","updateHandler","onUpdated","eventName","faviconHandler","favicons","favicon","off","removeTab","onRemoved","onCreated","onActivated","getType","getURL","createTabDetails","getActiveTabFromWebContents","getSize","audible","isCurrentlyAudible","autoDiscardable","discarded","favIconUrl","highlighted","incognito","mutedInfo","muted","audioMuted","pinned","selected","status","isLoading","getTitle","windowId","impl","assignTabDetails","getTabDetails","TAB_ID_NONE","WINDOW_ID_CURRENT","lastFocusedWindowId","browserWindow","code","info","isSet","filteredTabs","reloadProperties","bypassCache","reloadIgnoringCache","updateProperties","loadURL","setAudioMuted","ids","prevDetails","compareProps","didUpdate","WINDOW_ID_NONE","getAllWindows","find","isWindowClosing","activeChanged","setActiveTab","tabInfo","cacheTabId","electron","getFrame","frameProcessId","frameRoutingId","webFrameMain","fromId","getFrameId","frame","top","frameTreeNodeId","getParentFrameId","parentFrame","getFrameDetails","errorOccurred","processId","parentFrameId","WebNavigationAPI","sendNavigationEvent","onCreatedNavigationTarget","args","sourceTabId","sourceProcessId","sourceFrameId","timeStamp","onBeforeNavigate","isSameDocument","onCommitted","httpResponseCode","httpStatusText","isMainFrame","onHistoryStateUpdated","transitionType","transitionQualifiers","onDOMContentLoaded","isLoadingMainFrame","onFinishLoad","getAllFrames","mainFrame","targetFrame","framesInSubtree","getWindowState","isMaximized","isMinimized","isFullScreen","getLastFocused","observeWindow","window","onFocusChanged","windowDetailsCache","removeWindow","createWindowDetails","focused","isFocused","getPosition","left","ownerWindow","isPersistent","state","alwaysOnTop","isAlwaysOnTop","sessionId","getWindowDetails","getWindowFromId","getCurrentWindow","getWindowById","getLastFocusedWindow","windows","createWindow","maximize","minimize","restore","removedWindowId","windowDetails","electronSession","ExtensionStore","ExtensionRouter","sessionMap","WeakMap","ElectronChromeExtensions","fromSession","modulePath","api","defaultSession","__dirname","browserAction","contextMenus","commands","notifications","runtime","webNavigation","prependPreload","preloads","getPreloads","preloadPath","preloadIndex","splice","setPreloads","preloadExists","isFile","addTab","selectTab","addExtensionHost","host","warn","getContextMenuItems","addExtension","Extensions","supportsPreferredSize","major","versions","shift","destroyed","hidden","usingPreferredSize","readyPromise","isDevToolsOpened","closeDevTools","maybeClose","getFocusedWindow","updatePreferredSize","setSize","updatePosition","movable","maximizable","minimizable","resizable","skipTaskbar","backgroundColor","webPreferences","sandbox","nodeIntegration","nodeIntegrationInWorker","contextIsolation","enablePreferredSizeMode","untypedWebContents","load","hasChildNodes","executeJavaScript","document","BOUNDS","minWidth","minHeight","Promise","resolve","setTimeout","queryPreferredSize","whenReady","rect","min","maxWidth","max","maxHeight","setBounds","getBounds","winBounds","viewBounds","POSITION_PADDING","getBoundingClientRect","defaultMinWidth","defaultMinHeight","i","offsetWidth","offsetHeight","ipcMain","createDebug","shortenValues","k","v","formatters","r","JSON","stringify","DEFAULT_SESSION","gRoutingDelegate","RoutingDelegate","onRouterMessage","handlerName","onExtensionMessage","onRemoteMessage","sessionPartition","ses","fromPartition","onAddListener","listener","onRemoveListener","removeListener","addObserver","eventListenerEquals","eventListener","other","delegate","handlers","listeners","extensionHosts","filterListeners","predicate","filteredListeners","delta","observeListenerHost","eventListeners","existingEventListener","findIndex","getHandler","handler","extEvent","el","ipcName","windowToActiveTab","addWindow","windowHasTabs","getActiveTabFromWindow","wc","fromWebContents","prevActiveTab"],"sourceRoot":""}